<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-cosmos-sdk docs-doc-id-docs/architecture/adr-071-crypto-v2-multi-curve" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">ADR 071: Cryptography v2- Multi-curve support | Interchain Stack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs-interchain.io/dev-portal-docsite/cosmos-sdk/next/docs/architecture/adr-071-crypto-v2-multi-curve"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-cosmos-sdk-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-cosmos-sdk-current"><meta data-rh="true" property="og:title" content="ADR 071: Cryptography v2- Multi-curve support | Interchain Stack"><meta data-rh="true" name="description" content="Change log"><meta data-rh="true" property="og:description" content="Change log"><link data-rh="true" rel="icon" href="/dev-portal-docsite/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs-interchain.io/dev-portal-docsite/cosmos-sdk/next/docs/architecture/adr-071-crypto-v2-multi-curve"><link data-rh="true" rel="alternate" href="https://docs-interchain.io/dev-portal-docsite/cosmos-sdk/next/docs/architecture/adr-071-crypto-v2-multi-curve" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs-interchain.io/dev-portal-docsite/cosmos-sdk/next/docs/architecture/adr-071-crypto-v2-multi-curve" hreflang="x-default"><script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="be413c15-3002-497e-9e30-676ea0039a9e" data-project-name="InterchainStack" data-project-color="#FFFFFF" data-button-text-color="#000" data-submit-query-button-bg-color="#000000" data-modal-disclaimer="InterchainGPT is a fine-tuned LLM for the Interchain with access to Interchain Stack developer documentation and resources. Please note that answers are generated by an AI so please use your best judgement before implementing" data-modal-image="img/spirograph.svg" data-project-logo="img/spirograph.svg" data-user-analytics-fingerprint-enabled="true" async></script><link rel="stylesheet" href="/dev-portal-docsite/assets/css/styles.3411b2aa.css">
<link rel="preload" href="/dev-portal-docsite/assets/js/runtime~main.e260afe7.js" as="script">
<link rel="preload" href="/dev-portal-docsite/assets/js/main.175a359f.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">The Interchain Stack Docsite is in MVP state; please submit comments with the feedback button. The Ask AI button is also very powerful.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dev-portal-docsite/"><div class="navbar__logo"><img src="/dev-portal-docsite/img/interchain_logo.svg" alt="Interchain Docs" class="themedImage_ToTc themedImage--light_HNdA"><img src="/dev-portal-docsite/img/interchain_logo.svg" alt="Interchain Docs" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/dev-portal-docsite/onboarding">Onboarding</a><a class="navbar__item navbar__link" href="/dev-portal-docsite/ibc-go">IBC-Go</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dev-portal-docsite/cosmos-sdk/learn">CosmosSDK</a><a href="https://docs.cometbft.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">CometBFT</a><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">CosmWasm</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/dev-portal-docsite/cosmos-sdk/next/docs/learn/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/dev-portal-docsite/cosmos-sdk/next/docs/architecture/adr-071-crypto-v2-multi-curve">Next</a></li><li><a class="dropdown__link" href="/dev-portal-docsite/cosmos-sdk/learn/">0.52</a></li><li><a class="dropdown__link" href="/dev-portal-docsite/cosmos-sdk/0.50/learn/">0.50</a></li><li><a class="dropdown__link" href="/dev-portal-docsite/cosmos-sdk/0.47/learn/">0.47</a></li></ul></div><a href="https://github.com/interchainio/dev-portal-docsite" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="github-icon">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 0.300049C5.4 0.300049 0 5.70005 0 12.3001C0 17.6001 3.4 22.1001 8.2 23.7001C8.8 23.8001 9 23.4001 9 23.1001C9 22.8001 9 22.1001 9 21.1001C5.7 21.8001 5 19.5001 5 19.5001C4.5 18.1001 3.7 17.7001 3.7 17.7001C2.5 17.0001 3.7 17.0001 3.7 17.0001C4.9 17.1001 5.5 18.2001 5.5 18.2001C6.6 20.0001 8.3 19.5001 9 19.2001C9.1 18.4001 9.4 17.9001 9.8 17.6001C7.1 17.3001 4.3 16.3001 4.3 11.7001C4.3 10.4001 4.8 9.30005 5.5 8.50005C5.5 8.10005 5 6.90005 5.7 5.30005C5.7 5.30005 6.7 5.00005 9 6.50005C10 6.20005 11 6.10005 12 6.10005C13 6.10005 14 6.20005 15 6.50005C17.3 4.90005 18.3 5.30005 18.3 5.30005C19 7.00005 18.5 8.20005 18.4 8.50005C19.2 9.30005 19.6 10.4001 19.6 11.7001C19.6 16.3001 16.8 17.3001 14.1 17.6001C14.5 18.0001 14.9 18.7001 14.9 19.8001C14.9 21.4001 14.9 22.7001 14.9 23.1001C14.9 23.4001 15.1 23.8001 15.7 23.7001C20.5 22.1001 23.9 17.6001 23.9 12.3001C24 5.70005 18.6 0.300049 12 0.300049Z" fill="currentColor"/>
            </svg>
            </a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-cosmos-sdk-current,docs-onboarding-v0.50.x,docs-ibc-go-v8.5.x"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Interchain Stack<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/dev-portal-docsite/cosmos-sdk/learn/">latest version</a></b> (<!-- -->0.52<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>ADR 071: Cryptography v2- Multi-curve support</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="change-log">Change log<a href="#change-log" class="hash-link" aria-label="Direct link to Change log" title="Direct link to Change log">​</a></h2><ul><li>May 7th 2024: Initial Draft (Zondax AG: @raynaudoe @juliantoledano @jleni @educlerici-zondax @lucaslopezf)</li><li>June 13th 2024: Add CometBFT implementation proposal (Zondax AG: @raynaudoe @juliantoledano @jleni @educlerici-zondax @lucaslopezf)</li><li>July 2nd 2024: Split ADR proposal, add link to ADR in cosmos/crypto (Zondax AG: @raynaudoe @juliantoledano @jleni @educlerici-zondax @lucaslopezf)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="status">Status<a href="#status" class="hash-link" aria-label="Direct link to Status" title="Direct link to Status">​</a></h2><p>DRAFT</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a href="#abstract" class="hash-link" aria-label="Direct link to Abstract" title="Direct link to Abstract">​</a></h2><p>This ADR proposes the refactoring of the existing <code>Keyring</code> and <code>cosmos-sdk/crypto</code> code to implement <a href="https://github.com/cosmos/crypto/blob/main/docs/architecture/adr-001-crypto-provider.md" target="_blank" rel="noopener noreferrer">ADR-001-CryptoProviders</a>.</p><p>For in-depth details of the <code>CryptoProviders</code> and their design please refer to ADR mentioned above.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>The introduction of multi-curve support in the cosmos-sdk cryptographic package offers significant advantages. By not being restricted to a single cryptographic curve, developers can choose the most appropriate curve based on security, performance, and compatibility requirements. This flexibility enhances the application&#x27;s ability to adapt to evolving security standards and optimizes performance for specific use cases, helping to future-proofing the sdk&#x27;s cryptographic capabilities.</p><p>The enhancements in this proposal not only render the <a href="https://github.com/cosmos/cosmos-sdk/issues/14940" target="_blank" rel="noopener noreferrer">&quot;Keyring ADR&quot;</a> obsolete, but also encompass its key aspects, replacing it with a more flexible and comprehensive approach. Furthermore, the gRPC service proposed in the mentioned ADR can be easily implemented as a specialized <code>CryptoProvider</code>. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="glossary">Glossary<a href="#glossary" class="hash-link" aria-label="Direct link to Glossary" title="Direct link to Glossary">​</a></h3><ol><li><p><strong>Interface</strong>: In the context of this document, &quot;interface&quot; refers to Go&#x27;s interface.</p></li><li><p><strong>Module</strong>: In this document, &quot;module&quot; refers to a Go module.</p></li><li><p><strong>Package</strong>: In the context of Go, a &quot;package&quot; refers to a unit of code organization.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a href="#context" class="hash-link" aria-label="Direct link to Context" title="Direct link to Context">​</a></h2><p>In order to fully understand the need for changes and the proposed improvements, it&#x27;s crucial to consider the current state of affairs:</p><ul><li><p>The Cosmos SDK currently lacks a comprehensive ADR for the cryptographic package.</p></li><li><p>If a blockchain project requires a cryptographic curve that is not supported by the current SDK, the most likely scenario is that they will need to fork the SDK repository and make modifications. These modifications could potentially make the fork incompatible with future updates from the upstream SDK, complicating maintenance and integration.</p></li><li><p>Type leakage of specific crypto data types expose backward compatibility and extensibility challenges.</p></li><li><p>The demand for a more flexible and extensible approach to cryptography and address management is high.</p></li><li><p>Architectural changes are necessary to resolve many of the currently open issues related to new curves support.</p></li><li><p>There is a current trend towards modularity in the Interchain stack (e.g., runtime modules).</p></li><li><p>Security implications are a critical consideration during the redesign work.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="objectives">Objectives<a href="#objectives" class="hash-link" aria-label="Direct link to Objectives" title="Direct link to Objectives">​</a></h2><p>The key objectives for this proposal are:</p><ul><li>Leverage <code>CryptoProviders</code>: Utilize them as APIs for cryptographic tools, ensuring modularity, flexibility, and ease of integration.</li></ul><p>Developer-Centric Approach</p><ul><li>Prioritize clear, intuitive interfaces and best-practice design principles.</li></ul><p>Quality Assurance</p><ul><li>Enhanced Test Coverage: Improve testing methodologies to ensure the robustness and reliability of the module.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="technical-goals">Technical Goals<a href="#technical-goals" class="hash-link" aria-label="Direct link to Technical Goals" title="Direct link to Technical Goals">​</a></h2><p>New Keyring:</p><ul><li>Design a new <code>Keyring</code> interface with modular backends injection system to support hardware devices and cloud-based HSMs. This feature is optional and tied to complexity; if it proves too complex, it will be deferred to a future release as an enhancement.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="proposed-architecture">Proposed architecture<a href="#proposed-architecture" class="hash-link" aria-label="Direct link to Proposed architecture" title="Direct link to Proposed architecture">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="components">Components<a href="#components" class="hash-link" aria-label="Direct link to Components" title="Direct link to Components">​</a></h3><p>The main components to be used will be the same as those found in the <a href="https://github.com/cosmos/crypto/blob/main/docs/architecture/adr-001-crypto-provider.md#components" target="_blank" rel="noopener noreferrer">ADR-001</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="storage-and-persistence">Storage and persistence<a href="#storage-and-persistence" class="hash-link" aria-label="Direct link to Storage and persistence" title="Direct link to Storage and persistence">​</a></h4><p>The storage and persistence layer is tasked with storing a <code>CryptoProvider</code>s. Specifically, this layer must:</p><ul><li>Securely store the crypto provider&#x27;s associated private key (only if stored locally, otherwise a reference to the private key will be stored instead).</li><li>Store the <a href="https://github.com/cosmos/crypto/blob/main/docs/architecture/adr-001-crypto-provider.md#metadata" target="_blank" rel="noopener noreferrer"><code>ProviderMetadata</code></a> struct which contains the data that distinguishes that provider.</li></ul><p>The purpose of this layer is to ensure that upon retrieval of the persisted data, we can access the provider&#x27;s type, version, and specific configuration (which varies based on the provider type). This information will subsequently be utilized to initialize the appropriate factory, as detailed in the following section on the factory pattern.</p><p>The storage proposal involves using a modified version of the <a href="https://github.com/cosmos/cosmos-sdk/blob/main/proto/cosmos/crypto/keyring/v1/record.proto" target="_blank" rel="noopener noreferrer">Record</a> struct, which is already defined in <strong>Keyring/v1</strong>. Additionally, we propose utilizing the existing keyring backends (keychain, filesystem, memory, etc.) to store these <code>Record</code>s in the same manner as the current <strong>Keyring/v1</strong>.</p><p><em>Note: This approach will facilitate a smoother migration path from the current Keyring/v1 to the proposed architecture.</em></p><p>Below is the proposed protobuf message to be included in the modified <code>Record.proto</code> file</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="protobuf-message-structure">Protobuf message structure<a href="#protobuf-message-structure" class="hash-link" aria-label="Direct link to Protobuf message structure" title="Direct link to Protobuf message structure">​</a></h5><p>The <a href="https://github.com/cosmos/cosmos-sdk/blob/main/proto/cosmos/crypto/keyring/v1/record.proto" target="_blank" rel="noopener noreferrer">record.proto</a> file will be modified to include the <code>CryptoProvider</code> message as an optional field as follows.</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// record.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Record {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string name = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Any pub_key = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oneof item {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Local local = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ledger ledger = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Multi multi = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Offline offline = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CryptoProvider crypto_provider = 7; // &lt;- New</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  message Local {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    google.protobuf.Any priv_key = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  message Ledger {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hd.v1.BIP44Params path = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  message Multi {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  message Offline {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="creating-and-loading-a-cryptoprovider">Creating and loading a <code>CryptoProvider</code><a href="#creating-and-loading-a-cryptoprovider" class="hash-link" aria-label="Direct link to creating-and-loading-a-cryptoprovider" title="Direct link to creating-and-loading-a-cryptoprovider">​</a></h5><p>For creating providers, we propose a <em>factory pattern</em> and a <em>registry</em> for these builders. Examples of these
patterns can be found <a href="https://github.com/cosmos/crypto/blob/main/docs/architecture/adr-001-crypto-provider.md#illustrative-code-snippets" target="_blank" rel="noopener noreferrer">here</a></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="keyring">Keyring<a href="#keyring" class="hash-link" aria-label="Direct link to Keyring" title="Direct link to Keyring">​</a></h5><p>The new <code>Keyring</code> interface will serve as a central hub for managing and fetching <code>CryptoProviders</code>. To ensure a smoother migration path, the new Keyring will be backward compatible with the previous version. Since this will be the main API from which applications will obtain their <code>CryptoProvider</code> instances, the proposal is to extend the Keyring interface to include the methods:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> KeyringV2 </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// methods from Keyring/v1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ListCryptoProviders returns a list of all the stored CryptoProvider metadata.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ListCryptoProviders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">ProviderMetadata</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// GetCryptoProvider retrieves a specific CryptoProvider by its id.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">GetCryptoProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CryptoProvider</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Note</em>: Methods to obtain a provider from a public key or other means that make it easier to load the desired provider can be added.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="especial-use-case-remote-signers">Especial use case: remote signers<a href="#especial-use-case-remote-signers" class="hash-link" aria-label="Direct link to Especial use case: remote signers" title="Direct link to Especial use case: remote signers">​</a></h5><p>It&#x27;s important to note that the <code>CryptoProvider</code> interface is versatile enough to be implemented as a remote signer. This capability allows for the integration of remote cryptographic operations, which can be particularly useful in distributed or cloud-based environments where local cryptographic resources are limited or need to be managed centrally.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="alternatives">Alternatives<a href="#alternatives" class="hash-link" aria-label="Direct link to Alternatives" title="Direct link to Alternatives">​</a></h2><p>It is important to note that all the code presented in this document is not in its final form and could be subject to changes at the time of implementation. The examples and implementations discussed should be interpreted as alternatives, providing a conceptual framework rather than definitive solutions. This flexibility allows for adjustments based on further insights, technical evaluations, or changing requirements as development progresses.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision">Decision<a href="#decision" class="hash-link" aria-label="Direct link to Decision" title="Direct link to Decision">​</a></h2><p>We will:</p><ul><li>Leverage crypto providers</li><li>Refactor the module structure as described above.</li><li>Define types and interfaces as the code attached.</li><li>Refactor existing code into new structure and interfaces.</li><li>Implement Unit Tests to ensure no backward compatibility issues.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consequences">Consequences<a href="#consequences" class="hash-link" aria-label="Direct link to Consequences" title="Direct link to Consequences">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="impact-on-the-sdk-codebase">Impact on the SDK codebase<a href="#impact-on-the-sdk-codebase" class="hash-link" aria-label="Direct link to Impact on the SDK codebase" title="Direct link to Impact on the SDK codebase">​</a></h3><p>We can divide the impact of this ADR into two main categories: state machine code and client related code.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="client">Client<a href="#client" class="hash-link" aria-label="Direct link to Client" title="Direct link to Client">​</a></h4><p>The major impact will be on the client side, where the current <code>Keyring</code> interface will be replaced by the new <code>KeyringV2</code> interface. At first, the impact will be low since <code>CryptoProvider</code> is an optional field in the <code>Record</code> message, so there&#x27;s no mandatory requirement for migrating to this new concept right away. This allows a progressive transition where the risks of breaking changes or regressions are minimized.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="state-machine">State Machine<a href="#state-machine" class="hash-link" aria-label="Direct link to State Machine" title="Direct link to State Machine">​</a></h4><p>The impact on the state machine code will be minimal, the modules affected (at the time of writing this ADR)
are the <code>x/accounts</code> module, specifically the <code>Authenticate</code> function and the <code>x/auth/ante</code> module. This function will need to be adapted to use a <code>CryptoProvider</code> service to make use of the <code>Verifier</code> instance.</p><p>Worth mentioning that there&#x27;s also the alternative of using <code>Verifier</code> instances in a standalone fashion (see note below).</p><p>The specific way to adapt these modules will be deeply analyzed and decided at implementation time of this ADR.</p><p><em>Note</em>: All cryptographic tools (hashers, verifiers, signers, etc.) will continue to be available as standalone packages that can be imported and utilized directly without the need for a <code>CryptoProvider</code> instance. However, the <code>CryptoProvider</code> is the recommended method for using these tools as it offers a more secure way to handle sensitive data, enhanced modularity, and the ability to store configurations and metadata within the <code>CryptoProvider</code> definition.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backwards-compatibility">Backwards Compatibility<a href="#backwards-compatibility" class="hash-link" aria-label="Direct link to Backwards Compatibility" title="Direct link to Backwards Compatibility">​</a></h3><p>The proposed migration path is similar to what the cosmos-sdk has done in the past. To ensure a smooth transition, the following steps will be taken:</p><p>Once ADR-001 is implemented with a stable release:</p><ul><li>Deprecate the old crypto package. The old crypto package will still be usable, but it will be marked as deprecated and users can opt to use the new package.</li><li>Migrate the codebase to use the new cosmos/crypto package and remove the old crypto one.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="positive">Positive<a href="#positive" class="hash-link" aria-label="Direct link to Positive" title="Direct link to Positive">​</a></h3><ul><li>Single place of truth</li><li>Easier to use interfaces</li><li>Easier to extend</li><li>Unit test for each crypto package</li><li>Greater maintainability</li><li>Incentivize addition of implementations instead of forks</li><li>Decoupling behavior from implementation</li><li>Sanitization of code</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="negative">Negative<a href="#negative" class="hash-link" aria-label="Direct link to Negative" title="Direct link to Negative">​</a></h3><ul><li>It will involve an effort to adapt existing code.</li><li>It will require attention to detail and audition.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="neutral">Neutral<a href="#neutral" class="hash-link" aria-label="Direct link to Neutral" title="Direct link to Neutral">​</a></h3><ul><li>It will involve extensive testing.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-cases">Test Cases<a href="#test-cases" class="hash-link" aria-label="Direct link to Test Cases" title="Direct link to Test Cases">​</a></h2><ul><li>The code will be unit tested to ensure a high code coverage</li><li>There should be integration tests around Keyring and CryptoProviders.</li></ul><blockquote><p>While an ADR is in the DRAFT or PROPOSED stage, this section should contain a
summary of issues to be solved in future iterations (usually referencing comments
from a pull-request discussion).</p><p>Later, this section can optionally list ideas or improvements the author or
reviewers found during the analysis of this ADR.</p></blockquote></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#change-log" class="table-of-contents__link toc-highlight">Change log</a></li><li><a href="#status" class="table-of-contents__link toc-highlight">Status</a></li><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a></li><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a><ul><li><a href="#glossary" class="table-of-contents__link toc-highlight">Glossary</a></li></ul></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#objectives" class="table-of-contents__link toc-highlight">Objectives</a></li><li><a href="#technical-goals" class="table-of-contents__link toc-highlight">Technical Goals</a></li><li><a href="#proposed-architecture" class="table-of-contents__link toc-highlight">Proposed architecture</a><ul><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a></li></ul></li><li><a href="#alternatives" class="table-of-contents__link toc-highlight">Alternatives</a></li><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a></li><li><a href="#consequences" class="table-of-contents__link toc-highlight">Consequences</a><ul><li><a href="#impact-on-the-sdk-codebase" class="table-of-contents__link toc-highlight">Impact on the SDK codebase</a></li><li><a href="#backwards-compatibility" class="table-of-contents__link toc-highlight">Backwards Compatibility</a></li><li><a href="#positive" class="table-of-contents__link toc-highlight">Positive</a></li><li><a href="#negative" class="table-of-contents__link toc-highlight">Negative</a></li><li><a href="#neutral" class="table-of-contents__link toc-highlight">Neutral</a></li></ul></li><li><a href="#test-cases" class="table-of-contents__link toc-highlight">Test Cases</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">Stack Components</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/cosmos/ibc-go" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBC-Go<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/cosmos/cosmos-sdk" target="_blank" rel="noopener noreferrer" class="footer__link-item">CosmosSDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/cometbft/cometbft" target="_blank" rel="noopener noreferrer" class="footer__link-item">CometBFT<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item">CosmWasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/cosmos/relayer" target="_blank" rel="noopener noreferrer" class="footer__link-item">Go Relayer<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://hermes.informal.systems/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Hermes Relayer<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/cosmos/ibc-rs" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBC-rs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/strangelove-ventures/interchaintest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Interchaintest<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/invite/interchain" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/interchain_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@interchain_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://interchain.io/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2025 <a href="https://interchain.io/">Interchain Foundation</a>. All rights reserved.</div></div></div></footer></div>
<script src="/dev-portal-docsite/assets/js/runtime~main.e260afe7.js"></script>
<script src="/dev-portal-docsite/assets/js/main.175a359f.js"></script>
</body>
</html>