<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v0.50.x plugin-docs plugin-id-onboarding docs-doc-id-build-your-application/ibc-cosmwasm" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">IBC NameService Contract | Interchain Stack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs-interchain.io/dev-portal-docsite/onboarding/build/name-service-ibc-contract"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v0.50.x"><meta data-rh="true" name="docusaurus_tag" content="docs-onboarding-v0.50.x"><meta data-rh="true" name="docsearch:version" content="v0.50.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-onboarding-v0.50.x"><meta data-rh="true" property="og:title" content="IBC NameService Contract | Interchain Stack"><meta data-rh="true" name="description" content="You will build a new IBC contract with CosmWasm, enabling the same features we just built out in the IBC module. While this is a part 3 of the series, it can be done standalone as it requires a new chain. It is a similar concept to the previous parts 1 and 2, but with a smart contract focus instead of a chain."><meta data-rh="true" property="og:description" content="You will build a new IBC contract with CosmWasm, enabling the same features we just built out in the IBC module. While this is a part 3 of the series, it can be done standalone as it requires a new chain. It is a similar concept to the previous parts 1 and 2, but with a smart contract focus instead of a chain."><link data-rh="true" rel="icon" href="/dev-portal-docsite/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs-interchain.io/dev-portal-docsite/onboarding/build/name-service-ibc-contract"><link data-rh="true" rel="alternate" href="https://docs-interchain.io/dev-portal-docsite/onboarding/build/name-service-ibc-contract" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs-interchain.io/dev-portal-docsite/onboarding/build/name-service-ibc-contract" hreflang="x-default"><script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="be413c15-3002-497e-9e30-676ea0039a9e" data-project-name="InterchainStack" data-project-color="#FFFFFF" data-button-text-color="#000" data-submit-query-button-bg-color="#000000" data-modal-disclaimer="InterchainGPT is a fine-tuned LLM for the Interchain with access to Interchain Stack developer documentation and resources. Please note that answers are generated by an AI so please use your best judgement before implementing" data-modal-image="img/spirograph.svg" data-project-logo="img/spirograph.svg" data-user-analytics-fingerprint-enabled="true" async></script><link rel="stylesheet" href="/dev-portal-docsite/assets/css/styles.3411b2aa.css">
<link rel="preload" href="/dev-portal-docsite/assets/js/runtime~main.e260afe7.js" as="script">
<link rel="preload" href="/dev-portal-docsite/assets/js/main.175a359f.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">The Interchain Stack Docsite is in MVP state; please submit comments with the feedback button. The Ask AI button is also very powerful.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dev-portal-docsite/"><div class="navbar__logo"><img src="/dev-portal-docsite/img/interchain_logo.svg" alt="Interchain Docs" class="themedImage_ToTc themedImage--light_HNdA"><img src="/dev-portal-docsite/img/interchain_logo.svg" alt="Interchain Docs" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dev-portal-docsite/onboarding">Onboarding</a><a class="navbar__item navbar__link" href="/dev-portal-docsite/ibc-go">IBC-Go</a><a class="navbar__item navbar__link" href="/dev-portal-docsite/cosmos-sdk/learn">CosmosSDK</a><a href="https://docs.cometbft.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">CometBFT</a><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">CosmWasm</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/dev-portal-docsite/onboarding/">v0.50.x</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/dev-portal-docsite/onboarding/next/">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/dev-portal-docsite/onboarding/build/name-service-ibc-contract">v0.50.x</a></li></ul></div><a href="https://github.com/interchainio/dev-portal-docsite" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="github-icon">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 0.300049C5.4 0.300049 0 5.70005 0 12.3001C0 17.6001 3.4 22.1001 8.2 23.7001C8.8 23.8001 9 23.4001 9 23.1001C9 22.8001 9 22.1001 9 21.1001C5.7 21.8001 5 19.5001 5 19.5001C4.5 18.1001 3.7 17.7001 3.7 17.7001C2.5 17.0001 3.7 17.0001 3.7 17.0001C4.9 17.1001 5.5 18.2001 5.5 18.2001C6.6 20.0001 8.3 19.5001 9 19.2001C9.1 18.4001 9.4 17.9001 9.8 17.6001C7.1 17.3001 4.3 16.3001 4.3 11.7001C4.3 10.4001 4.8 9.30005 5.5 8.50005C5.5 8.10005 5 6.90005 5.7 5.30005C5.7 5.30005 6.7 5.00005 9 6.50005C10 6.20005 11 6.10005 12 6.10005C13 6.10005 14 6.20005 15 6.50005C17.3 4.90005 18.3 5.30005 18.3 5.30005C19 7.00005 18.5 8.20005 18.4 8.50005C19.2 9.30005 19.6 10.4001 19.6 11.7001C19.6 16.3001 16.8 17.3001 14.1 17.6001C14.5 18.0001 14.9 18.7001 14.9 19.8001C14.9 21.4001 14.9 22.7001 14.9 23.1001C14.9 23.4001 15.1 23.8001 15.7 23.7001C20.5 22.1001 23.9 17.6001 23.9 12.3001C24 5.70005 18.6 0.300049 12 0.300049Z" fill="currentColor"/>
            </svg>
            </a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-cosmos-sdk-0.52,docs-onboarding-v0.50.x,docs-ibc-go-v8.5.x"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev-portal-docsite/onboarding/">Spawn Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dev-portal-docsite/onboarding/install/system-setup">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/dev-portal-docsite/onboarding/build/name-service">Build Your Application</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal-docsite/onboarding/build/name-service">Build a Name Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal-docsite/onboarding/build/name-service-structure">Set Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal-docsite/onboarding/build/name-service-application">Application Logic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal-docsite/onboarding/build/name-service-client">Configure Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal-docsite/onboarding/build/name-service-testnet">Testnet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal-docsite/onboarding/build/name-service-bonus">Bonus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal-docsite/onboarding/build/name-service-summary">Summary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal-docsite/onboarding/build/name-service-ibc-module">IBC NameService (Part 2)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dev-portal-docsite/onboarding/build/name-service-ibc-contract">IBC Contract (Part 3)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dev-portal-docsite/onboarding/demo/ibc">Application Demos</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dev-portal-docsite/onboarding/learn/consensus-security">Learn</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/dev-portal-docsite/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Build Your Application</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">IBC Contract (Part 3)</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v0.50.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>IBC Name Service Contract</h1><p>You will build a new IBC contract with <a href="https://cosmwasm.com" target="_blank" rel="noopener noreferrer">CosmWasm</a>, enabling the same features we just built out in the IBC module. While this is a part 3 of the series, it can be done standalone as it requires a new chain. It is a similar concept to the previous parts 1 and 2, but with a smart contract focus instead of a chain.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2><ul><li><a href="/dev-portal-docsite/onboarding/install/system-setup">System Setup</a></li><li><a href="/dev-portal-docsite/onboarding/install/install-spawn">Install Spawn</a></li><li><a href="/dev-portal-docsite/onboarding/install/system-setup">Rust + CosmWasm</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-the-chain">Setup the Chain<a href="#setup-the-chain" class="hash-link" aria-label="Direct link to Setup the Chain" title="Direct link to Setup the Chain">​</a></h2><p>Build a new blockchain with CosmWasm enabled.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">GITHUB_USERNAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">rollchains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spawn new cwchain </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--consensus</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">proof-of-stake </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--bech32</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">roll </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--denom</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">uroll </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--bin</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">rolld </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--disabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">block-explorer </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--org</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${GITHUB_USERNAME}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># move into the chain directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> cwchain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># download latest dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go mod tidy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-cosmwasm-contract">Build CosmWasm Contract<a href="#build-cosmwasm-contract" class="hash-link" aria-label="Direct link to Build CosmWasm Contract" title="Direct link to Build CosmWasm Contract">​</a></h2><p>CosmWasm has a template repository that is used to generate new contracts. A minimal contract will be built with the <code>nameservice-contract</code> name provided on a <a href="https://github.com/CosmWasm/cw-template/commits/a2a169164324aa1b48ab76dd630f75f504e41d99/" target="_blank" rel="noopener noreferrer">specific commit</a>.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo generate --git https://github.com/CosmWasm/cw-template.git </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --name nameservice-contract </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --force-git-init </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -d </span><span class="token assign-left variable" style="color:#36acaa">minimal</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true --tag a2a169164324aa1b48ab76dd630f75f504e41d99</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Open the contract in your code editor now to begin adding the application logic.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Info</div><div class="admonitionContent_S0QG"><p>It is useful to install code rust extensions like <a href="https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer" target="_blank" rel="noopener noreferrer">rust-analyzer</a> and <a href="https://marketplace.visualstudio.com/items?itemName=tamasfe.even-better-toml" target="_blank" rel="noopener noreferrer">even better toml</a> for an increased editing experience.</p></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># open using vscode in the terminal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code nameservice-contract/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-contract-dependencies">Update Contract Dependencies<a href="#update-contract-dependencies" class="hash-link" aria-label="Direct link to Update Contract Dependencies" title="Direct link to Update Contract Dependencies">​</a></h2><p>This version of the CosmWasm template has some outdated versions. Update these in the <code>Cargo.toml</code> file and add the &quot;ibc3&quot; capability (for IBC support).</p><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Cargo.toml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">cosmwasm-schema = &quot;1.5.7&quot;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">cosmwasm-std = { version = &quot;1.5.7&quot;, features = [</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    # &quot;cosmwasm_1_3&quot;,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    &quot;ibc3&quot;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">] }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Update your local environment with the dependencies.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-state">Setup State<a href="#setup-state" class="hash-link" aria-label="Direct link to Setup State" title="Direct link to Setup State">​</a></h2><p>This Rust code defines the structure for a name service in a CosmWasm smart contract. It saves a map of all channels (outside chain connections) to a list of wallet address and their associated names.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/state.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use std::collections::BTreeMap;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use cw_storage_plus::Map;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">// Pair the wallet address to the name a user provides.</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub type WalletMapping = BTreeMap&lt;String, String&gt;;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">/// create a new empty wallet mapping for a channel.</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">/// useful if a channel is opened and we have no data yet</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn new_wallet_mapping() -&gt; WalletMapping {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    BTreeMap::new()</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">/// Name Service maps for each channel saved to a storage object</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub const NAME_SERVICE: Map&lt;String, WalletMapping&gt; = Map::new(&quot;nameservice&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-interactions">Setup Interactions<a href="#setup-interactions" class="hash-link" aria-label="Direct link to Setup Interactions" title="Direct link to Setup Interactions">​</a></h2><p>Now that the state is setup, focus on modeling the users interaction with the contract. Users should be able to set a name. This also requires an input for a &quot;channel&quot; since a contract could connect to multiple chains. It could be written in a way that a user could set it to all channels, but for simplicity, we will require a channel to be specified. Just as is set, a user should get the name with the same format: a channel and a wallet address. Then a new message type is added specifically for IBCExecution messages. This is the packet transfered over the network, between chains, and gives the ability to set a name elsewhere on its contract.</p><p>The contract will call the IBCExecuteMsg when a user runs the ExecuteMsg.SendName function. This indirectly generates the packet and submits it for the user.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/msg.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use cosmwasm_schema::{cw_serde, QueryResponses};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct InstantiateMsg {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum ExecuteMsg {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    SetName { channel: String, name: String },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(QueryResponses)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum QueryMsg {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    #[returns(GetNameResponse)]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    GetName { channel: String, wallet: String },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub enum IbcExecuteMsg {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    SetName { wallet: String, name: String },</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub struct GetNameResponse {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    pub name: String,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="contract-logic">Contract Logic<a href="#contract-logic" class="hash-link" aria-label="Direct link to Contract Logic" title="Direct link to Contract Logic">​</a></h2><p>Here are all the imports used in this. Replace your files top.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/contract.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cfg(not(feature = &quot;library&quot;))]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use cosmwasm_std::entry_point;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use cosmwasm_std::{Binary, Deps, DepsMut, Env, MessageInfo, Response, StdResult};</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use crate::error::ContractError;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use crate::msg::{ExecuteMsg, IbcExecuteMsg, InstantiateMsg, QueryMsg};</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use cosmwasm_std::{to_json_binary, IbcMsg, IbcTimeout, StdError};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Instantiate creates a new version of this contract that you control. Rather than being unimplemented, return a basic response saying it was Ok (successful) and add some extra logging metadata.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/contract.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn instantiate(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _deps: DepsMut,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _env: Env,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _info: MessageInfo,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _msg: InstantiateMsg,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    Ok(Response::new().add_attribute(&quot;method&quot;, &quot;instantiate&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The ExecuteMsg::SetName method is allowed to be interacted from anyone. Just like instantiate we return a new Ok response. This time an add_message function is added. This will generate the packet as the user interacts, performing a new action from a previous action. This uses the IbcMsg::SendPacket built in type to create it for the user. Notice the data field includes the IbcExecuteMsg::SetName we defined before. This is transferred to the other version of this contract on another chain and processed.</p><p>If the packet is not picked up by a relayer service provider within a few minutes, the packet will become void and stop attempting execution on the other chain&#x27;s contract.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/contract.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _deps: DepsMut,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    env: Env, // removes the underscore _</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    info: MessageInfo,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    msg: ExecuteMsg,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    match msg {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        ExecuteMsg::SetName { channel, name } =&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            Ok(Response::new()</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                .add_attribute(&quot;method&quot;, &quot;set_name&quot;)</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                .add_attribute(&quot;channel&quot;, channel.clone())</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                // outbound IBC message, where packet is then received on other chain</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                .add_message(IbcMsg::SendPacket {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    channel_id: channel,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    data: to_json_binary(&amp;IbcExecuteMsg::SetName {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        name: name,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        wallet: info.sender.into_string(),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    })?,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    // default timeout of two minutes.</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    timeout: IbcTimeout::with_timestamp(env.block.time.plus_seconds(120)),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                }))</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The users name is not set, but it is only useful if you can also get said data. Read from the <code>NAME_SERVICE</code> storage Map defined in <code>state.rs</code>. Using may load grabs the data if the channel has a name set. If no channel is found (no users have set a name from this chain), it returns an error to the user requesting. If a channel of pairs is found, it loads them and checks if the wallet address requested is set in it. If it is, return what the wallets name is set to. If the user with this wallet did not set a name, return an error.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/contract.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn query(deps: Deps, _env: Env, msg: QueryMsg) -&gt; StdResult&lt;Binary&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    match msg {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        QueryMsg::GetName { channel, wallet } =&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            crate::state::NAME_SERVICE</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                .may_load(deps.storage, channel.clone())</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                .and_then(|maybe_wallets| match maybe_wallets {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    Some(wallets) =&gt; match wallets.get(&amp;wallet) {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        Some(wallet) =&gt; Ok(to_json_binary(&amp;crate::msg::GetNameResponse {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            name: wallet.clone(),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        })?),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        None =&gt; Err(StdError::generic_err(&quot;No name set for wallet&quot;)),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    },</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    None =&gt; Err(StdError::generic_err(&quot;Channel not found&quot;)),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                })</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The contract will receive a packet and must run logic to process it. This is called the <code>try_set_name</code> method. It updates a given channel to include a new wallet. If the wallet already exists, it will overwrite the name. It then returns the users name back, or an error, for our future IBC logic to handle.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/contract.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">/// called on IBC packet receive in other chain</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn try_set_name(</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    deps: DepsMut,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    channel: String,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    wallet: String,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    name: String,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;String, StdError&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    crate::state::NAME_SERVICE.update(deps.storage, channel, |wallets| -&gt; StdResult&lt;_&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        let mut wallets = wallets.unwrap_or_default();</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        wallets.insert(wallet, name.clone());</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        Ok(wallets)</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    })?;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    Ok(name)</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-transaction-acknowledgement">Create Transaction acknowledgement<a href="#create-transaction-acknowledgement" class="hash-link" aria-label="Direct link to Create Transaction acknowledgement" title="Direct link to Create Transaction acknowledgement">​</a></h2><p>Create a new file, <code>ack.rs</code>, to handle the IBC ACK (acknowledgement) messages. This just returns back to the user if their interaction was a success or an error.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> src/ack.rs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/ack.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use cosmwasm_schema::cw_serde;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use cosmwasm_std::{to_json_binary, Binary};</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">/// IBC ACK. See:</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">/// https://github.com/cosmos/cosmos-sdk/blob/f999b1ff05a4db4a338a855713864497bedd4396/proto/ibc/core/channel/v1/channel.proto#L141-L147</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub enum Ack {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    Result(Binary),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    Error(String),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn make_ack_success() -&gt; Binary {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    let res = Ack::Result(b&quot;1&quot;.into());</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    to_json_binary(&amp;res).unwrap()</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn make_ack_fail(err: String) -&gt; Binary {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    let res = Ack::Error(err);</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    to_json_binary(&amp;res).unwrap()</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Note</div><div class="admonitionContent_S0QG"><p>Rust has a lib.rs file that is the entry point for the Rust library. All files that are used must be mentioned here to have access to them.</p></div></div><p>Add the ack logic to the lib.rs so the application can use it.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/lib.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub mod ack;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub mod contract;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub use crate::error::ContractError;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-errors">Setup Errors<a href="#setup-errors" class="hash-link" aria-label="Direct link to Setup Errors" title="Direct link to Setup Errors">​</a></h2><p>If a relayer or contract try to connect to an unlike protocol, the InvalidVersion error will be returned to the attempted actor. This contract only supports 1 protocol version across networks because it must speak the same &quot;language&quot;. If you speak english while another person speaks spanish, your interactions are incompatible. Contracts are like this too. They verify their protocol version in a format like &quot;ics-20&quot; or &quot;ns-1&quot; first to make sure they can communicate.</p><p>OrderedChannel is a type of flow control for network packets, or interactions. This tutorial uses unordered paths so any packet that times out or fails does not block future packets from going through. If a relayer tries to make this an ordered path, the contract returns this error to stop them from doing so.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/error.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use cosmwasm_std::StdError;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use thiserror::Error;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Error, Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum ContractError {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[error(&quot;{0}&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Std(#[from] StdError),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[error(&quot;Unauthorized&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unauthorized {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Add any other custom errors you like here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Look at https://docs.rs/thiserror/1.0.21/thiserror/ for details.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    #[error(&quot;invalid IBC channel version. Got ({actual}), expected ({expected})&quot;)]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    InvalidVersion { actual: String, expected: String },</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    #[error(&quot;only unordered channels are supported&quot;)]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    OrderedChannel {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">// There is an IBC specific error that is never returned.</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[derive(Error, Debug)]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub enum Never {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ibc-specific-logic">IBC Specific Logic<a href="#ibc-specific-logic" class="hash-link" aria-label="Direct link to IBC Specific Logic" title="Direct link to IBC Specific Logic">​</a></h2><p>Create a new file <code>ibc.rs</code>. Add this to the lib.rs. This is where our core IBC logic will go.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> src/ibc.rs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/lib.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub mod ibc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub mod ack;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub mod contract;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod error;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub mod helpers;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub mod msg;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub mod state;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub use crate::error::ContractError;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Place the following in the ibc.rs file. Import all the types needed, set the IBC version to &quot;ns-1&quot; to stand for &quot;nameservice-1&quot;, and add the basic validation logic for the contract. You must ensure contracts that try to talk together are verified to work together. This is that logic.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/ibc.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cfg(not(feature = &quot;library&quot;))]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use cosmwasm_std::entry_point;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use cosmwasm_std::{</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    from_json, DepsMut, Env, IbcBasicResponse, IbcChannel, IbcChannelCloseMsg,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    IbcChannelConnectMsg, IbcChannelOpenMsg, IbcChannelOpenResponse, IbcOrder, IbcPacketAckMsg,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    IbcPacketReceiveMsg, IbcPacketTimeoutMsg, IbcReceiveResponse,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">use crate::{</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    ack::{make_ack_fail, make_ack_success},</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    contract::try_set_name,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    msg::IbcExecuteMsg,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    state::NAME_SERVICE,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    ContractError,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub const IBC_VERSION: &amp;str = &quot;ns-1&quot;;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn validate_order_and_version(</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    channel: &amp;IbcChannel,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    counterparty_version: Option&lt;&amp;str&gt;,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;(), ContractError&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // We expect an unordered channel here. Ordered channels have the</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // property that if a message is lost the entire channel will stop</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // working until you start it again.</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    if channel.order != IbcOrder::Unordered {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        return Err(ContractError::OrderedChannel {});</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    if channel.version != IBC_VERSION {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        return Err(ContractError::InvalidVersion {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            actual: channel.version.to_string(),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            expected: IBC_VERSION.to_string(),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // Make sure that we&#x27;re talking with a counterparty who speaks the</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // same &quot;protocol&quot; as us.</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    //</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // For a connection between chain A and chain B being established</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // by chain A, chain B knows counterparty information during</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // `OpenTry` and chain A knows counterparty information during</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // `OpenAck`. We verify it when we have it but when we don&#x27;t it&#x27;s</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // alright.</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    if let Some(counterparty_version) = counterparty_version {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        if counterparty_version != IBC_VERSION {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            return Err(ContractError::InvalidVersion {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                actual: counterparty_version.to_string(),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                expected: IBC_VERSION.to_string(),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    Ok(())</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The contract verifies data on an attempted open of a new connection. Ensure the contracts talk the same protocol language, and that all the validation basic logic is connect. Then when a channel is closed, clear the data from storage for it. It is very rare you would want to close a channel.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/ibc.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">/// Handles the `OpenInit` and `OpenTry` parts of the IBC handshake.</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn ibc_channel_open(</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _deps: DepsMut,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _env: Env,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    msg: IbcChannelOpenMsg,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;IbcChannelOpenResponse, ContractError&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    validate_order_and_version(msg.channel(), msg.counterparty_version())?;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    Ok(None)</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn ibc_channel_close(</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    deps: DepsMut,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _env: Env,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    msg: IbcChannelCloseMsg,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;IbcBasicResponse, ContractError&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    let channel = msg.channel().endpoint.channel_id.clone();</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    NAME_SERVICE.remove(deps.storage, channel.clone());</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    Ok(IbcBasicResponse::new()</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        .add_attribute(&quot;method&quot;, &quot;ibc_channel_close&quot;)</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        .add_attribute(&quot;channel&quot;, channel))</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When a successful connection is made, the contract saves a new blank wallet mapping to the channel&#x27;s unique id. &#x27;channel-0&#x27; is the first. All  future connections are channel-1, channel-2, etc. This is the first step in the IBC process. The contract is now ready to receive packets once the handler logic is put in place on receive.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/ibc.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn ibc_channel_connect(</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    deps: DepsMut,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _env: Env,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    msg: IbcChannelConnectMsg,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;IbcBasicResponse, ContractError&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    validate_order_and_version(msg.channel(), msg.counterparty_version())?;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    let channel = msg.channel().endpoint.channel_id.clone();</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    NAME_SERVICE.save(</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        deps.storage, channel.clone(), &amp;crate::state::new_wallet_mapping(),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    )?;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    Ok(IbcBasicResponse::new()</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        .add_attribute(&quot;method&quot;, &quot;ibc_channel_connect&quot;)</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        .add_attribute(&quot;channel_id&quot;, channel))</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ibc_packet_receive handles incoming packets from already connected networks. The packet is forwarded to this contract and processed in <code>do_ibc_packet_receive</code>. It takes the channel and the packet data <em>(the IbcMsg::SetName sent out from the ExecuteMsg earlier)</em>, and tries to set the name on a wallet for this channel. If successful, it returns an acknowledgment of success. If not, it returns an acknowledgment of failure. The user will see this in their log event output.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/ibc.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn ibc_packet_receive(</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    deps: DepsMut,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _env: Env,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    msg: IbcPacketReceiveMsg,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;IbcReceiveResponse, crate::error::Never&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // Regardless of if our processing of this packet works we need to</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // commit an ACK to the chain. As such, we wrap all handling logic</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // in a septate function and on error write out an error ack.</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    match do_ibc_packet_receive(deps, msg) {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        Ok(response) =&gt; Ok(response),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        Err(error) =&gt; Ok(IbcReceiveResponse::new()</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            .add_attribute(&quot;method&quot;, &quot;ibc_packet_receive&quot;)</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            .add_attribute(&quot;error&quot;, error.to_string())</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            .set_ack(make_ack_fail(error.to_string()))),</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn do_ibc_packet_receive(</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    deps: DepsMut,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    msg: IbcPacketReceiveMsg,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;IbcReceiveResponse, ContractError&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    // The channel this packet is being relayed along on this chain.</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    let channel = msg.packet.dest.channel_id;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    let msg: IbcExecuteMsg = from_json(&amp;msg.packet.data)?;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    match msg {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        IbcExecuteMsg::SetName { wallet, name } =&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            let name = try_set_name(deps, channel, wallet, name)?;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            Ok(IbcReceiveResponse::new()</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                .add_attribute(&quot;method&quot;, &quot;execute_increment&quot;)</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                .add_attribute(&quot;name&quot;, name)</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                .set_ack(make_ack_success()))</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sometimes after a failed acknowledgement the contract may want to rollback some data or make note of it for future reference. This contract is simple enough so no rollback or refunds are required. We just return a basic response to the user for both the ack or a timeout. Think of this similarly as a NoOp (no operation).</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/ibc.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn ibc_packet_ack(</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _deps: DepsMut,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _env: Env,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _ack: IbcPacketAckMsg,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;IbcBasicResponse, ContractError&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    Ok(IbcBasicResponse::new().add_attribute(&quot;method&quot;, &quot;ibc_packet_ack&quot;))</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">pub fn ibc_packet_timeout(</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _deps: DepsMut,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _env: Env,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    _msg: IbcPacketTimeoutMsg,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;IbcBasicResponse, ContractError&gt; {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    Ok(IbcBasicResponse::new().add_attribute(&quot;method&quot;, &quot;ibc_packet_timeout&quot;))</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-contract-from-source">Build Contract From Source<a href="#build-contract-from-source" class="hash-link" aria-label="Direct link to Build Contract From Source" title="Direct link to Build Contract From Source">​</a></h2><p>The contract can now be compiled from its source into the .wasm file. This is the binary executable that will be uploaded to the chain.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo-run-script optimize</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="start-the-chains-and-connect">Start the chains and connect<a href="#start-the-chains-and-connect" class="hash-link" aria-label="Direct link to Start the chains and connect" title="Direct link to Start the chains and connect">​</a></h3><p>Make sure you are in the <code>cwchain</code> directory to begin interacting and uploading the contract to the chain. It is time to start the cosmwasm chain and launch a testnet that connects to itself. The <code>self-ibc</code> chain is automatically generated for you on the creation with spawn. It launches 2 of your networks, localchain-1 and localchain-2, and connects them with a relayer operator at startup.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># move back into the cwchain directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install heighliner if you have not already</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (Easily docker builder tool)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> get-heighliner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Build docker image, set configs, keys, and install binary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Error 1 (ignored) codes are okay here if you already have</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the keys and configs setup. If so you only have to `make local-image`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># in future runs :)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> setup-testnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local-ic start self-ibc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="store-the-contract-on-both-chains">Store the Contract on both chains<a href="#store-the-contract-on-both-chains" class="hash-link" aria-label="Direct link to Store the Contract on both chains" title="Direct link to Store the Contract on both chains">​</a></h3><p>Get the <a href="https://www.techtarget.com/searchapparchitecture/definition/Remote-Procedure-Call-RPC" target="_blank" rel="noopener noreferrer">RPC </a> interaction addresses for each network from the local-interchain testnet API. Upload the contract source to both chains using the different RPC addresses.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">RPC_1</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">curl</span><span class="token variable" style="color:#36acaa"> http://127.0.0.1:8080/info </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> jq -r .logs.chains</span><span class="token variable punctuation" style="color:#393A34">[</span><span class="token variable number" style="color:#36acaa">0</span><span class="token variable punctuation" style="color:#393A34">]</span><span class="token variable" style="color:#36acaa">.rpc_address</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">RPC_2</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">curl</span><span class="token variable" style="color:#36acaa"> http://127.0.0.1:8080/info </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> jq -r .logs.chains</span><span class="token variable punctuation" style="color:#393A34">[</span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable punctuation" style="color:#393A34">]</span><span class="token variable" style="color:#36acaa">.rpc_address</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Using RPC_1=</span><span class="token string variable" style="color:#36acaa">$RPC_1</span><span class="token string" style="color:#e3116c"> and RPC_2=</span><span class="token string variable" style="color:#36acaa">$RPC_2</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CONTRACT_SOURCE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">./nameservice-contract/artifacts/nameservice_contract.wasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rolld tx wasm store </span><span class="token variable" style="color:#36acaa">$CONTRACT_SOURCE</span><span class="token plain"> --from</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">acc0 --gas</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">auto --gas-adjustment</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"> --yes --node</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$RPC_1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># rolld q wasm list-code --node=$RPC_1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rolld tx wasm store </span><span class="token variable" style="color:#36acaa">$CONTRACT_SOURCE</span><span class="token plain"> --from</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">acc0 --gas</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">auto --gas-adjustment</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"> --yes --node</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$RPC_2</span><span class="token plain"> --chain-id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">localchain-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># rolld q wasm list-code --node=$RPC_2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="instantiate-our-contract-on-both-chains">Instantiate our Contract on both chains<a href="#instantiate-our-contract-on-both-chains" class="hash-link" aria-label="Direct link to Instantiate our Contract on both chains" title="Direct link to Instantiate our Contract on both chains">​</a></h3><p>You can now create your contract from the source on each chain.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rolld tx wasm instantiate </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{}&#x27;</span><span class="token plain"> --no-admin --from</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">acc0 --label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;ns-1&quot;</span><span class="token plain"> --gas</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">auto --gas-adjustment</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"> --yes --node</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$RPC_1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rolld tx wasm instantiate </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{}&#x27;</span><span class="token plain"> --no-admin --from</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">acc0 --label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;ns-1&quot;</span><span class="token plain"> --gas</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">auto --gas-adjustment</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"> --yes --node</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$RPC_2</span><span class="token plain"> --chain-id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">localchain-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rolld q wasm list-contracts-by-creator roll1hj5fveer5cjtn4wd6wstzugjfdxzl0xpg2te87</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rolld q wasm list-contracts-by-creator roll1hj5fveer5cjtn4wd6wstzugjfdxzl0xpg2te87 --node</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$RPC_2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">NSERVICE_CONTRACT</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">roll14hj2tavq8fpesdwxxcu44rty3hh90vhujrvcmstl4zr3txmfvw9sjczpjh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="relayer-connect">Relayer connect<a href="#relayer-connect" class="hash-link" aria-label="Direct link to Relayer connect" title="Direct link to Relayer connect">​</a></h3><p>The relayer must now connect the contracts together and create an IBC connection, link, between them. Use the Local-Interchain helper methods to connect the contracts across the chains. This command will take a second then show a bunch of logs. <code>Error context canceled</code> is fine to see. You will verify they were opened in the next step.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># This will take a moment.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Connects the 2 contracts together with the IBC relayer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local-ic interact localchain-1 relayer-exec </span><span class="token string" style="color:#e3116c">&quot;rly tx link localchain-1_localchain-2 --src-port wasm.</span><span class="token string variable" style="color:#36acaa">${NSERVICE_CONTRACT}</span><span class="token string" style="color:#e3116c"> --dst-port=wasm.</span><span class="token string variable" style="color:#36acaa">${NSERVICE_CONTRACT}</span><span class="token string" style="color:#e3116c"> --order unordered --version ns-1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="verify-channels">Verify channels<a href="#verify-channels" class="hash-link" aria-label="Direct link to Verify channels" title="Direct link to Verify channels">​</a></h2><p>Verify the channels were created. Query either with the application binary of the relayer itself. If you see both a channel-0 and channel-1 in your logs, it was a success. If you only see channel-0 re-run the above relayer exec tx link command.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># app binary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rolld q ibc channel channels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># relayer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local-ic interact localchain-1 relayer-exec </span><span class="token string" style="color:#e3116c">&quot;rly q channels localchain-1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-interaction">Transaction interaction<a href="#transaction-interaction" class="hash-link" aria-label="Direct link to Transaction interaction" title="Direct link to Transaction interaction">​</a></h2><p>Using the ExecuteMsg::SetName method, set a name. This will be transferred to chain 2 behind the scenes. Flushing the relayer will force it to auto pick up pending IBC packets and transfer them across. Not running this may take up to 30 seconds for the relayer to automatically pick it up.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Set the name from chain 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MESSAGE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;{&quot;set_name&quot;:{&quot;channel&quot;:&quot;channel-1&quot;,&quot;name&quot;:&quot;myname&quot;}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rolld tx wasm execute </span><span class="token variable" style="color:#36acaa">$NSERVICE_CONTRACT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$MESSAGE</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> --from</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">acc0 --gas</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">auto --gas-adjustment</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"> --yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This will take a moment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># &#x27;account sequence mismatch&#x27; errors are fine.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local-ic interact localchain-1 relayer-exec </span><span class="token string" style="color:#e3116c">&quot;rly tx flush&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verify-data">Verify data<a href="#verify-data" class="hash-link" aria-label="Direct link to Verify data" title="Direct link to Verify data">​</a></h3><p>After the packet is sent over the network, processed, and acknowledged <em>(something that can be done in less than 30 seconds)</em>, you can query the data on chain 2. You can also dump all the contract data out to get HEX and BASE64 encoded data for what the contract state storage looks like.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># query the name on chain 2, from chain 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rolld q wasm state smart </span><span class="token variable" style="color:#36acaa">$NSERVICE_CONTRACT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;get_name&quot;:{&quot;channel&quot;:&quot;channel-1&quot;,&quot;wallet&quot;:&quot;roll1hj5fveer5cjtn4wd6wstzugjfdxzl0xpg2te87&quot;}}&#x27;</span><span class="token plain"> --node</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$RPC_2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dump contract state from the other chain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rolld q wasm state all </span><span class="token variable" style="color:#36acaa">$NSERVICE_CONTRACT</span><span class="token plain"> --node</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$RPC_2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>You just build an IBC protocol using cosmwasm! It allowed you to set a name on another network entirely and securely with IBC.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-you-learned">What you Learned<a href="#what-you-learned" class="hash-link" aria-label="Direct link to What you Learned" title="Direct link to What you Learned">​</a></h2><ul><li>Scaffolding an CosmWasm contract</li><li>Adding business logic for an IBC request</li><li>Implementing IBC in a contract</li><li>Connecting two CosmWasm contracts with a custom IBC protocol</li><li>Sending a packet from contract A to contract B</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/dev-portal-docsite/onboarding/build/name-service-ibc-module"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">IBC NameService (Part 2)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/dev-portal-docsite/onboarding/demo/ibc"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">IBC Transfers</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#setup-the-chain" class="table-of-contents__link toc-highlight">Setup the Chain</a></li><li><a href="#build-cosmwasm-contract" class="table-of-contents__link toc-highlight">Build CosmWasm Contract</a></li><li><a href="#update-contract-dependencies" class="table-of-contents__link toc-highlight">Update Contract Dependencies</a></li><li><a href="#setup-state" class="table-of-contents__link toc-highlight">Setup State</a></li><li><a href="#setup-interactions" class="table-of-contents__link toc-highlight">Setup Interactions</a></li><li><a href="#contract-logic" class="table-of-contents__link toc-highlight">Contract Logic</a></li><li><a href="#create-transaction-acknowledgement" class="table-of-contents__link toc-highlight">Create Transaction acknowledgement</a></li><li><a href="#setup-errors" class="table-of-contents__link toc-highlight">Setup Errors</a></li><li><a href="#ibc-specific-logic" class="table-of-contents__link toc-highlight">IBC Specific Logic</a></li><li><a href="#build-contract-from-source" class="table-of-contents__link toc-highlight">Build Contract From Source</a><ul><li><a href="#start-the-chains-and-connect" class="table-of-contents__link toc-highlight">Start the chains and connect</a></li><li><a href="#store-the-contract-on-both-chains" class="table-of-contents__link toc-highlight">Store the Contract on both chains</a></li><li><a href="#instantiate-our-contract-on-both-chains" class="table-of-contents__link toc-highlight">Instantiate our Contract on both chains</a></li><li><a href="#relayer-connect" class="table-of-contents__link toc-highlight">Relayer connect</a></li></ul></li><li><a href="#verify-channels" class="table-of-contents__link toc-highlight">Verify channels</a></li><li><a href="#transaction-interaction" class="table-of-contents__link toc-highlight">Transaction interaction</a><ul><li><a href="#verify-data" class="table-of-contents__link toc-highlight">Verify data</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#what-you-learned" class="table-of-contents__link toc-highlight">What you Learned</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">Stack Components</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/cosmos/ibc-go" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBC-Go<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/cosmos/cosmos-sdk" target="_blank" rel="noopener noreferrer" class="footer__link-item">CosmosSDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/cometbft/cometbft" target="_blank" rel="noopener noreferrer" class="footer__link-item">CometBFT<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item">CosmWasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/cosmos/relayer" target="_blank" rel="noopener noreferrer" class="footer__link-item">Go Relayer<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://hermes.informal.systems/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Hermes Relayer<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/cosmos/ibc-rs" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBC-rs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/strangelove-ventures/interchaintest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Interchaintest<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/invite/interchain" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/interchain_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@interchain_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://interchain.io/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2025 <a href="https://interchain.io/">Interchain Foundation</a>. All rights reserved.</div></div></div></footer></div>
<script src="/dev-portal-docsite/assets/js/runtime~main.e260afe7.js"></script>
<script src="/dev-portal-docsite/assets/js/main.175a359f.js"></script>
</body>
</html>