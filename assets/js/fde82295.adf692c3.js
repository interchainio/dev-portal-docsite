"use strict";(self.webpackChunkdev_portal_docsite=self.webpackChunkdev_portal_docsite||[]).push([[91744],{15680:(e,n,o)=>{o.d(n,{xA:()=>p,yg:()=>u});var t=o(96540);function a(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function i(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,t)}return o}function r(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?i(Object(o),!0).forEach((function(n){a(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function s(e,n){if(null==e)return{};var o,t,a=function(e,n){if(null==e)return{};var o,t,a={},i=Object.keys(e);for(t=0;t<i.length;t++)o=i[t],n.indexOf(o)>=0||(a[o]=e[o]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)o=i[t],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var l=t.createContext({}),c=function(e){var n=t.useContext(l),o=n;return e&&(o="function"==typeof e?e(n):r(r({},n),e)),o},p=function(e){var n=c(e.components);return t.createElement(l.Provider,{value:n},e.children)},d="mdxType",g={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var o=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(o),m=a,u=d["".concat(l,".").concat(m)]||d[m]||g[m]||i;return o?t.createElement(u,r(r({ref:n},p),{},{components:o})):t.createElement(u,r({ref:n},p))}));function u(e,n){var o=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=o.length,r=new Array(i);r[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[d]="string"==typeof e?e:a,r[1]=s;for(var c=2;c<i;c++)r[c]=o[c];return t.createElement.apply(null,r)}return t.createElement.apply(null,o)}m.displayName="MDXCreateElement"},35029:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>g,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var t=o(58168),a=(o(96540),o(15680));const i={sidebar_position:1},r="Encoding",s={unversionedId:"docs/learn/advanced/encoding",id:"docs/learn/advanced/encoding",title:"Encoding",description:"While encoding in the Cosmos SDK used to be mainly handled by go-amino codec, the Cosmos SDK is moving towards using gogoprotobuf for both state and client-side encoding.",source:"@site/cosmos-sdk/docs/learn/advanced/05-encoding.md",sourceDirName:"docs/learn/advanced",slug:"/docs/learn/advanced/encoding",permalink:"/dev-portal-docsite/cosmos-sdk/next/docs/learn/advanced/encoding",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"learnSidebar",previous:{title:"Store",permalink:"/dev-portal-docsite/cosmos-sdk/next/docs/learn/advanced/store"},next:{title:"gRPC, REST, and CometBFT Endpoints",permalink:"/dev-portal-docsite/cosmos-sdk/next/docs/learn/advanced/grpc_rest"}},l={},c=[{value:"Encoding",id:"encoding-1",level:2},{value:"Gogoproto",id:"gogoproto",level:3},{value:"Guidelines for protobuf message definitions",id:"guidelines-for-protobuf-message-definitions",level:3},{value:"Transaction Encoding",id:"transaction-encoding",level:3},{value:"Interface Encoding and Usage of <code>Any</code>",id:"interface-encoding-and-usage-of-any",level:3},{value:"<code>Any</code> Encoding in the Cosmos SDK",id:"any-encoding-in-the-cosmos-sdk",level:4},{value:"<code>Any</code>&#39;s TypeURL",id:"anys-typeurl",level:4},{value:"FAQ",id:"faq",level:2},{value:"How to create modules using protobuf encoding",id:"how-to-create-modules-using-protobuf-encoding",level:3},{value:"Defining module types",id:"defining-module-types",level:4},{value:"Naming and conventions",id:"naming-and-conventions",level:4}],p={toc:c},d="wrapper";function g(e){let{components:n,...o}=e;return(0,a.yg)(d,(0,t.A)({},p,o,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"encoding"},"Encoding"),(0,a.yg)("admonition",{title:"Synopsis",type:"note"},(0,a.yg)("p",{parentName:"admonition"},"While encoding in the Cosmos SDK used to be mainly handled by ",(0,a.yg)("inlineCode",{parentName:"p"},"go-amino")," codec, the Cosmos SDK is moving towards using ",(0,a.yg)("inlineCode",{parentName:"p"},"gogoprotobuf")," for both state and client-side encoding.")),(0,a.yg)("admonition",{title:"Pre-requisite Readings",type:"note"},(0,a.yg)("ul",{parentName:"admonition"},(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/next/docs/learn/beginner/app-anatomy"},"Anatomy of a Cosmos SDK application")))),(0,a.yg)("h2",{id:"encoding-1"},"Encoding"),(0,a.yg)("p",null,"The Cosmos SDK supports two wire encoding protocols. Binary encoding is fulfilled by ",(0,a.yg)("a",{parentName:"p",href:"https://protobuf.dev/"},"Protocol\nBuffers"),", specifically the\n",(0,a.yg)("a",{parentName:"p",href:"https://github.com/cosmos/gogoproto/"},"gogoprotobuf")," implementation, which is a subset of\n",(0,a.yg)("a",{parentName:"p",href:"https://protobuf.dev/programming-guides/proto3/"},"Proto3"),"  with an extension for\ninterface support.  Text encoding is fulfilled by ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/tendermint/go-amino"},"Amino"),"."),(0,a.yg)("p",null,"Due to Amino having significant performance drawbacks, being reflection-based, and not having\nany meaningful cross-language/client support, Amino is only used to generate JSON (Amino\nJSON) in order to support the Amino JSON sign mode, and for JSON RPC endpoints."),(0,a.yg)("p",null,"Binary wire encoding of types in the Cosmos SDK can be broken down into two main\ncategories, client encoding and store encoding. Client encoding mainly revolves\naround transaction processing and signing, whereas store encoding revolves around\ntypes used in state-machine transitions and what is ultimately stored in the Merkle\ntree."),(0,a.yg)("p",null,"For storage encoding, module developers are encouraged to use Protobuf encoding for their types\nbut may choose any encoding schema they like. The\n",(0,a.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/next/docs/build/packages/collections"},"collections")," package automatically handles encoding and\ndecoding of state for you."),(0,a.yg)("p",null,"In the ",(0,a.yg)("inlineCode",{parentName:"p"},"codec")," package, there exist two core interfaces, ",(0,a.yg)("inlineCode",{parentName:"p"},"BinaryCodec")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"JSONCodec"),",\nwhere the former encapsulates the current Amino interface except it operates on\ntypes implementing the latter instead of generic ",(0,a.yg)("inlineCode",{parentName:"p"},"interface{}")," types."),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"ProtoCodec"),", where both binary and JSON serialization are handled via Protobuf. This means\nthat modules may use Protobuf encoding, but the types must implement ",(0,a.yg)("inlineCode",{parentName:"p"},"ProtoMarshaler"),". If\nmodules wish to avoid implementing this interface for their types, this is autogenerated via\n",(0,a.yg)("a",{parentName:"p",href:"https://buf.build/"},"buf")),(0,a.yg)("h3",{id:"gogoproto"},"Gogoproto"),(0,a.yg)("p",null,"Modules are encouraged to utilize Protobuf encoding for their respective types. In the Cosmos SDK, we use the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/cosmos/gogoproto"},"Gogoproto")," specific implementation of the Protobuf spec that offers speed and DX improvements compared to the official ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/protocolbuffers/protobuf"},"Google protobuf implementation"),"."),(0,a.yg)("h3",{id:"guidelines-for-protobuf-message-definitions"},"Guidelines for protobuf message definitions"),(0,a.yg)("p",null,"In addition to ",(0,a.yg)("a",{parentName:"p",href:"https://protobuf.dev/programming-guides/proto3/#simple"},"following official Protocol Buffer guidelines"),", we recommend using these annotations in .proto files when dealing with interfaces:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"use ",(0,a.yg)("inlineCode",{parentName:"li"},"cosmos_proto.accepts_interface")," to annotate ",(0,a.yg)("inlineCode",{parentName:"li"},"Any")," fields that accept interfaces",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"pass the same fully qualified name as ",(0,a.yg)("inlineCode",{parentName:"li"},"protoName")," to ",(0,a.yg)("inlineCode",{parentName:"li"},"InterfaceRegistry.RegisterInterface")),(0,a.yg)("li",{parentName:"ul"},"example: ",(0,a.yg)("inlineCode",{parentName:"li"},'(cosmos_proto.accepts_interface) = "cosmos.gov.v1beta1.Content"')," (and not just ",(0,a.yg)("inlineCode",{parentName:"li"},"Content"),")"))),(0,a.yg)("li",{parentName:"ul"},"annotate interface implementations with ",(0,a.yg)("inlineCode",{parentName:"li"},"cosmos_proto.implements_interface"),(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"pass the same fully qualified name as ",(0,a.yg)("inlineCode",{parentName:"li"},"protoName")," to ",(0,a.yg)("inlineCode",{parentName:"li"},"InterfaceRegistry.RegisterInterface")),(0,a.yg)("li",{parentName:"ul"},"example: ",(0,a.yg)("inlineCode",{parentName:"li"},'(cosmos_proto.implements_interface) = "cosmos.authz.v1beta1.Authorization"')," (and not just ",(0,a.yg)("inlineCode",{parentName:"li"},"Authorization"),")")))),(0,a.yg)("p",null,"Code generators can then match the ",(0,a.yg)("inlineCode",{parentName:"p"},"accepts_interface")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"implements_interface")," annotations to know whether some Protobuf messages are allowed to be packed in a given ",(0,a.yg)("inlineCode",{parentName:"p"},"Any")," field or not."),(0,a.yg)("h3",{id:"transaction-encoding"},"Transaction Encoding"),(0,a.yg)("p",null,"Another important use of Protobuf is the encoding and decoding of\n",(0,a.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/next/docs/learn/advanced/transactions"},"transactions"),". Transactions are defined by the application or\nthe Cosmos SDK but are then passed to the underlying consensus engine to be relayed to\nother peers. Since the underlying consensus engine is agnostic to the application,\nthe consensus engine accepts only transactions in the form of raw bytes."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"The ",(0,a.yg)("inlineCode",{parentName:"li"},"TxEncoder")," object performs the encoding."),(0,a.yg)("li",{parentName:"ul"},"The ",(0,a.yg)("inlineCode",{parentName:"li"},"TxDecoder")," object performs the decoding.")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.1/types/tx_msg.go#L117-L121\n")),(0,a.yg)("p",null,"A standard implementation of both these objects can be found in the ",(0,a.yg)("a",{parentName:"p",href:"https://docs.cosmos.network/main/build/modules/auth#transactions"},(0,a.yg)("inlineCode",{parentName:"a"},"auth/tx")," module"),":"),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.1/x/auth/tx/decoder.go"},"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.1/x/auth/tx/decoder.go")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.1/x/auth/tx/encoder.go\n")),(0,a.yg)("p",null,"See ",(0,a.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/next/docs/architecture/adr-020-protobuf-transaction-encoding"},"ADR-020")," for details of how a transaction is encoded."),(0,a.yg)("h3",{id:"interface-encoding-and-usage-of-any"},"Interface Encoding and Usage of ",(0,a.yg)("inlineCode",{parentName:"h3"},"Any")),(0,a.yg)("p",null,"The Protobuf DSL is strongly typed, which can make inserting variable-typed fields difficult. Imagine we want to create a ",(0,a.yg)("inlineCode",{parentName:"p"},"Profile")," protobuf message that serves as a wrapper over ",(0,a.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/next/docs/learn/beginner/accounts"},"an account"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-protobuf"},"message Profile {\n  // account is the account associated to a profile.\n  cosmos.auth.v1beta1.BaseAccount account = 1;\n  // bio is a short description of the account.\n  string bio = 4;\n}\n")),(0,a.yg)("p",null,"In this ",(0,a.yg)("inlineCode",{parentName:"p"},"Profile")," example, we hardcoded ",(0,a.yg)("inlineCode",{parentName:"p"},"account")," as a ",(0,a.yg)("inlineCode",{parentName:"p"},"BaseAccount"),". However, there are several other types of ",(0,a.yg)("a",{parentName:"p",href:"https://docs.cosmos.network/main/build/modules/auth/vesting"},"user accounts related to vesting"),", such as ",(0,a.yg)("inlineCode",{parentName:"p"},"BaseVestingAccount")," or ",(0,a.yg)("inlineCode",{parentName:"p"},"ContinuousVestingAccount"),". All of these accounts are different, but they all implement the ",(0,a.yg)("inlineCode",{parentName:"p"},"AccountI")," interface. How would you create a ",(0,a.yg)("inlineCode",{parentName:"p"},"Profile")," that allows all these types of accounts with an ",(0,a.yg)("inlineCode",{parentName:"p"},"account")," field that accepts an ",(0,a.yg)("inlineCode",{parentName:"p"},"AccountI")," interface?"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.2/types/account.go#L15-L32\n")),(0,a.yg)("p",null,"In ",(0,a.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/next/docs/architecture/adr-019-protobuf-state-encoding"},"ADR-019"),", it has been decided to use ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/any.proto"},(0,a.yg)("inlineCode",{parentName:"a"},"Any")),"s to encode interfaces in protobuf. An ",(0,a.yg)("inlineCode",{parentName:"p"},"Any")," contains an arbitrary serialized message as bytes, along with a URL that acts as a globally unique identifier for and resolves to that message's type. This strategy allows us to pack arbitrary Go types inside protobuf messages. Our new ",(0,a.yg)("inlineCode",{parentName:"p"},"Profile")," then looks like:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-protobuf"},'message Profile {\n  // account is the account associated to a profile.\n  google.protobuf.Any account = 1 [\n    (cosmos_proto.accepts_interface) = "cosmos.auth.v1beta1.AccountI"; // Asserts that this field only accepts Go types implementing `AccountI`. It is purely informational for now.\n  ];\n  // bio is a short description of the account.\n  string bio = 4;\n}\n')),(0,a.yg)("p",null,'To add an account inside a profile, we need to "pack" it inside an ',(0,a.yg)("inlineCode",{parentName:"p"},"Any")," first, using ",(0,a.yg)("inlineCode",{parentName:"p"},"codectypes.NewAnyWithValue"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-go"},'var myAccount AccountI\nmyAccount = ... // Can be a BaseAccount, a ContinuousVestingAccount or any struct implementing `AccountI`\n\n// Pack the account into an Any\naccAny, err := codectypes.NewAnyWithValue(myAccount)\nif err != nil {\n  return nil, err\n}\n\n// Create a new Profile with the any.\nprofile := Profile {\n  Account: accAny,\n  Bio: "some bio",\n}\n\n// We can then marshal the profile as usual.\nbz, err := cdc.Marshal(profile)\njsonBz, err := cdc.MarshalJSON(profile)\n')),(0,a.yg)("p",null,"To summarize, to encode an interface, you must 1/ pack the interface into an ",(0,a.yg)("inlineCode",{parentName:"p"},"Any")," and 2/ marshal the ",(0,a.yg)("inlineCode",{parentName:"p"},"Any"),". For convenience, the Cosmos SDK provides a ",(0,a.yg)("inlineCode",{parentName:"p"},"MarshalInterface")," method to bundle these two steps. Have a look at ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.2/x/auth/keeper/keeper.go#L262-L264"},"a real-life example in the x/auth module"),"."),(0,a.yg)("p",null,"The reverse operation of retrieving the concrete Go type from inside an ",(0,a.yg)("inlineCode",{parentName:"p"},"Any"),', called "unpacking", is done with the ',(0,a.yg)("inlineCode",{parentName:"p"},"GetCachedValue()")," on ",(0,a.yg)("inlineCode",{parentName:"p"},"Any"),"."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-go"},'profileBz := ... // The proto-encoded bytes of a Profile, e.g. retrieved through gRPC.\nvar myProfile Profile\n// Unmarshal the bytes into the myProfile struct.\nerr := cdc.Unmarshal(profilebz, &myProfile)\n\n// Let\'s see the types of the Account field.\nfmt.Printf("%T\\n", myProfile.Account)                  // Prints "Any"\nfmt.Printf("%T\\n", myProfile.Account.GetCachedValue()) // Prints "BaseAccount", "ContinuousVestingAccount" or whatever was initially packed in the Any.\n\n// Get the address of the account.\naccAddr := myProfile.Account.GetCachedValue().(AccountI).GetAddress()\n')),(0,a.yg)("p",null,"It is important to note that for ",(0,a.yg)("inlineCode",{parentName:"p"},"GetCachedValue()")," to work, ",(0,a.yg)("inlineCode",{parentName:"p"},"Profile")," (and any other structs embedding ",(0,a.yg)("inlineCode",{parentName:"p"},"Profile"),") must implement the ",(0,a.yg)("inlineCode",{parentName:"p"},"UnpackInterfaces")," method:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-go"},"func (p *Profile) UnpackInterfaces(unpacker codectypes.AnyUnpacker) error {\n  if p.Account != nil {\n    var account AccountI\n    return unpacker.UnpackAny(p.Account, &account)\n  }\n\n  return nil\n}\n")),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"UnpackInterfaces")," gets called recursively on all structs implementing this method, to allow all ",(0,a.yg)("inlineCode",{parentName:"p"},"Any"),"s to have their ",(0,a.yg)("inlineCode",{parentName:"p"},"GetCachedValue()")," correctly populated."),(0,a.yg)("p",null,"For more information about interface encoding, and especially on ",(0,a.yg)("inlineCode",{parentName:"p"},"UnpackInterfaces")," and how the ",(0,a.yg)("inlineCode",{parentName:"p"},"Any"),"'s ",(0,a.yg)("inlineCode",{parentName:"p"},"type_url")," gets resolved using the ",(0,a.yg)("inlineCode",{parentName:"p"},"InterfaceRegistry"),", please refer to ",(0,a.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/next/docs/architecture/adr-019-protobuf-state-encoding"},"ADR-019"),"."),(0,a.yg)("h4",{id:"any-encoding-in-the-cosmos-sdk"},(0,a.yg)("inlineCode",{parentName:"h4"},"Any")," Encoding in the Cosmos SDK"),(0,a.yg)("p",null,"The above ",(0,a.yg)("inlineCode",{parentName:"p"},"Profile")," example is a fictive example used for educational purposes. In the Cosmos SDK, we use ",(0,a.yg)("inlineCode",{parentName:"p"},"Any")," encoding in several places (non-exhaustive list):"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"the ",(0,a.yg)("inlineCode",{parentName:"li"},"cryptotypes.PubKey")," interface for encoding different types of public keys,"),(0,a.yg)("li",{parentName:"ul"},"the ",(0,a.yg)("inlineCode",{parentName:"li"},"sdk.Msg")," interface for encoding different ",(0,a.yg)("inlineCode",{parentName:"li"},"Msg"),"s in a transaction,"),(0,a.yg)("li",{parentName:"ul"},"the ",(0,a.yg)("inlineCode",{parentName:"li"},"AccountI")," interface for encoding different types of accounts (similar to the above example) in the x/auth query responses,"),(0,a.yg)("li",{parentName:"ul"},"the ",(0,a.yg)("inlineCode",{parentName:"li"},"EvidenceI")," interface for encoding different types of evidences in the x/evidence module,"),(0,a.yg)("li",{parentName:"ul"},"the ",(0,a.yg)("inlineCode",{parentName:"li"},"AuthorizationI")," interface for encoding different types of x/authz authorizations,"),(0,a.yg)("li",{parentName:"ul"},"the ",(0,a.yg)("a",{parentName:"li",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/x/staking/types/staking.pb.go#L340-L377"},(0,a.yg)("inlineCode",{parentName:"a"},"Validator"))," struct that contains information about a validator.")),(0,a.yg)("p",null,"A real-life example of encoding the pubkey as ",(0,a.yg)("inlineCode",{parentName:"p"},"Any")," inside the Validator struct in x/staking is shown in the following example:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.2/x/staking/types/validator.go#L43-L63\n")),(0,a.yg)("h4",{id:"anys-typeurl"},(0,a.yg)("inlineCode",{parentName:"h4"},"Any"),"'s TypeURL"),(0,a.yg)("p",null,"When packing a protobuf message inside an ",(0,a.yg)("inlineCode",{parentName:"p"},"Any"),", the message's type is uniquely defined by its type URL, which is the message's fully qualified name prefixed by a ",(0,a.yg)("inlineCode",{parentName:"p"},"/")," (slash) character. In some implementations of ",(0,a.yg)("inlineCode",{parentName:"p"},"Any"),", like the gogoproto one, there's generally ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/gogo/protobuf/blob/b03c65ea87cdc3521ede29f62fe3ce239267c1bc/protobuf/google/protobuf/any.proto#L87-L91"},"a resolvable prefix, e.g. ",(0,a.yg)("inlineCode",{parentName:"a"},"type.googleapis.com")),". However, in the Cosmos SDK, we made the decision to not include such prefix, to have shorter type URLs. The Cosmos SDK's own ",(0,a.yg)("inlineCode",{parentName:"p"},"Any")," implementation can be found in ",(0,a.yg)("inlineCode",{parentName:"p"},"github.com/cosmos/cosmos-sdk/codec/types"),"."),(0,a.yg)("p",null,"The Cosmos SDK is also switching away from gogoproto to the official ",(0,a.yg)("inlineCode",{parentName:"p"},"google.golang.org/protobuf")," (known as the Protobuf API v2). Its default ",(0,a.yg)("inlineCode",{parentName:"p"},"Any")," implementation also contains the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/protocolbuffers/protobuf-go/blob/v1.28.1/types/known/anypb/any.pb.go#L266"},(0,a.yg)("inlineCode",{parentName:"a"},"type.googleapis.com"))," prefix. To maintain compatibility with the SDK, the following methods from ",(0,a.yg)("inlineCode",{parentName:"p"},'"google.golang.org/protobuf/types/known/anypb"')," should not be used:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"anypb.New")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"anypb.MarshalFrom")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"anypb.Any#MarshalFrom"))),(0,a.yg)("p",null,"Instead, the Cosmos SDK provides helper functions in ",(0,a.yg)("inlineCode",{parentName:"p"},'"github.com/cosmos/cosmos-proto/anyutil"'),", which create an official ",(0,a.yg)("inlineCode",{parentName:"p"},"anypb.Any")," without inserting the prefixes:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"anyutil.New")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"anyutil.MarshalFrom"))),(0,a.yg)("p",null,"For example, to pack a ",(0,a.yg)("inlineCode",{parentName:"p"},"sdk.Msg")," called ",(0,a.yg)("inlineCode",{parentName:"p"},"internalMsg"),", use:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-diff"},'import (\n-   "google.golang.org/protobuf/types/known/anypb"\n+   "github.com/cosmos/cosmos-proto/anyutil"\n)\n\n- anyMsg, err := anypb.New(internalMsg.Message().Interface())\n+ anyMsg, err := anyutil.New(internalMsg.Message().Interface())\n\n- fmt.Println(anyMsg.TypeURL) // type.googleapis.com/cosmos.bank.v1beta1.MsgSend\n+ fmt.Println(anyMsg.TypeURL) // /cosmos.bank.v1beta1.MsgSend\n')),(0,a.yg)("h2",{id:"faq"},"FAQ"),(0,a.yg)("h3",{id:"how-to-create-modules-using-protobuf-encoding"},"How to create modules using protobuf encoding"),(0,a.yg)("h4",{id:"defining-module-types"},"Defining module types"),(0,a.yg)("p",null,"Protobuf types can be defined to encode:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"state"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/next/docs/build/building-modules/messages-and-queries#messages"},(0,a.yg)("inlineCode",{parentName:"a"},"Msg"),"s")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/next/docs/build/building-modules/query-services"},"Query services")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/next/docs/build/building-modules/genesis"},"genesis"))),(0,a.yg)("h4",{id:"naming-and-conventions"},"Naming and conventions"),(0,a.yg)("p",null,"We encourage developers to follow industry guidelines: ",(0,a.yg)("a",{parentName:"p",href:"https://protobuf.dev/programming-guides/style/"},"Protocol Buffers style guide"),"\nand ",(0,a.yg)("a",{parentName:"p",href:"https://buf.build/docs/style-guide"},"Buf"),", see more details in ",(0,a.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/next/docs/architecture/adr-023-protobuf-naming"},"ADR 023")))}g.isMDXComponent=!0}}]);