"use strict";(self.webpackChunkdev_portal_docsite=self.webpackChunkdev_portal_docsite||[]).push([[95911],{15680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>d});var r=n(96540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},y="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),y=l(n),u=o,d=y["".concat(c,".").concat(u)]||y[u]||g[u]||a;return n?r.createElement(d,s(s({ref:t},p),{},{components:n})):r.createElement(d,s({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[y]="string"==typeof e?e:o,s[1]=i;for(var l=2;l<a;l++)s[l]=n[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4949:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>g,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var r=n(58168),o=(n(96540),n(15680));const a={sidebar_position:1},s="Syncing",i={unversionedId:"docs/learn/advanced/syncing",id:"docs/learn/advanced/syncing",title:"Syncing",description:"Syncing is the process of downloading the blockchain and state from a remote node.",source:"@site/cosmos-sdk/docs/learn/advanced/18-syncing.md",sourceDirName:"docs/learn/advanced",slug:"/docs/learn/advanced/syncing",permalink:"/dev-portal-docsite/cosmos-sdk/next/docs/learn/advanced/syncing",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"learnSidebar",previous:{title:"Context",permalink:"/dev-portal-docsite/cosmos-sdk/next/docs/learn/advanced/context"}},c={},l=[{value:"Observing syncing progress",id:"observing-syncing-progress",level:2},{value:"Block Sync Metrics",id:"block-sync-metrics",level:3},{value:"Block sync configuration",id:"block-sync-configuration",level:3},{value:"State Sync Metrics",id:"state-sync-metrics",level:3},{value:"State sync configuration",id:"state-sync-configuration",level:3},{value:"Checking if sync is complete",id:"checking-if-sync-is-complete",level:3}],p={toc:l},y="wrapper";function g(e){let{components:t,...n}=e;return(0,o.yg)(y,(0,r.A)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"syncing"},"Syncing"),(0,o.yg)("p",null,"Syncing is the process of downloading the blockchain and state from a remote node."),(0,o.yg)("p",null,"There are the following types of syncing:  "),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Genesis Sync: operator downloads genesis, sets peers and syncs the blockchain by executing all blocks since genesis.    "),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},(0,o.yg)("strong",{parentName:"p"},"NOTE:")," requires a peer node that doesn't prune blocks (CometBFT state)."))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"State Sync: operator need to set ",(0,o.yg)("inlineCode",{parentName:"p"},"trust_height")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"trust_hash")," of a block that s/he trusts as well as ",(0,o.yg)("inlineCode",{parentName:"p"},"trust_period")," - the time how long the operator will trust the given block height. The app will query peer nodes to stream state from that blocks as well as all following blocks. Once the state is downloaded, the node will start executing all blocks since the ",(0,o.yg)("inlineCode",{parentName:"p"},"trust_height"),".  "),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},(0,o.yg)("strong",{parentName:"p"},"NOTE:")," requires a peer node that provides a state sync and is trusted by the validator. "))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Snapshot Sync: operator downloads a snapshot from snapshot provider (usually validators) s/he trusts. From there the operator needs to unpack the snapshot to the node directory, update config, set peers, set moniker, setup validator keys. Once the data directory is properly configured, the validator can start a node. The node will query blocks since the snapshot and execute them.  "),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},(0,o.yg)("strong",{parentName:"p"},"NOTE:")," requires a snapshot directory that is trusted by the validator.  ")))),(0,o.yg)("p",null,"Genesis Sync has zero trust assumptions, but it's the most resource heavy. It also requires a node with all blocks - many validators prune the blocks to optimize space.  "),(0,o.yg)("h2",{id:"observing-syncing-progress"},"Observing syncing progress"),(0,o.yg)("blockquote",null,(0,o.yg)("h3",{parentName:"blockquote",id:"note-this-section-applies-to-comet-users"},"Note: This section applies to comet users"),(0,o.yg)("p",{parentName:"blockquote"},"To enable the Prometheus metrics, set ",(0,o.yg)("inlineCode",{parentName:"p"},"instrumentation.prometheus=true")," in your config file. Metrics will be served under ",(0,o.yg)("inlineCode",{parentName:"p"},"/metrics")," on ",(0,o.yg)("inlineCode",{parentName:"p"},"26660")," port by default. Listen address can be changed in the config file (see ",(0,o.yg)("inlineCode",{parentName:"p"},"instrumentation.prometheus_listen_addr"),")."),(0,o.yg)("p",{parentName:"blockquote"},"More ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/cometbft/cometbft/blob/main/docs/explanation/core/metrics.md"},"here"),".")),(0,o.yg)("h3",{id:"block-sync-metrics"},"Block Sync Metrics"),(0,o.yg)("p",null,"They are defined ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/cometbft/cometbft/blob/main/internal/blocksync/metrics.go"},"here")," and are accessible from the node's metrics endpoint."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"blocksync_syncing"),": Indicates whether a node is currently block syncing."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"blocksync_num_txs"),": Number of transactions in the latest block."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"blocksync_total_txs"),": Total number of transactions."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"blocksync_block_size_bytes"),": Size of the latest block in bytes."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"blocksync_latest_block_height"),": Height of the latest block.")),(0,o.yg)("h3",{id:"block-sync-configuration"},"Block sync configuration"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-toml"},'[blocksync]\nversion = "v0" # version of the block sync protocol to use\n')),(0,o.yg)("h3",{id:"state-sync-metrics"},"State Sync Metrics"),(0,o.yg)("p",null,"They are defined ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/cometbft/cometbft/blob/main/statesync/metrics.go"},"here")," and are accessible from the node's metrics endpoint."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"statesync_syncing"),": Indicates whether a node is currently state syncing.")),(0,o.yg)("h3",{id:"state-sync-configuration"},"State sync configuration"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-toml"},'[statesync]\nenable = true # set to true to enable state sync\nrpc_servers = "" # comma-separated list of RPC servers for state sync\ntrust_height = 0 # block height to trust for state sync\ntrust_hash = "" # block hash to trust for state sync\ntrust_period = "168h0m0s" # trust period for light client verification\ndiscovery_time = "15s" # time to spend discovering snapshots before picking one\ntemp_dir = "" # directory for temporary state sync files\nchunk_request_timeout = "10s" # timeout for chunk requests\nchunk_fetchers = "4" # number of concurrent chunk fetchers\n')),(0,o.yg)("h3",{id:"checking-if-sync-is-complete"},"Checking if sync is complete"),(0,o.yg)("p",null,"Query the status using the app cli:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"app q consensus comet syncing\n")),(0,o.yg)("p",null,"Query for the node status using the REST or GRPC API:  "),(0,o.yg)("p",null,"REST example:  "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:1317/cosmos/base/tendermint/v1beta1/syncing  \n")),(0,o.yg)("p",null,"Expected response:  "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{  \n  "syncing": false  \n}  \n')),(0,o.yg)("p",null,"GRPC example:  "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"grpcurl -plaintext localhost:9090 cosmos.base.tendermint.v1beta1.Service/GetSyncing  \n")),(0,o.yg)("p",null,"The response includes ",(0,o.yg)("inlineCode",{parentName:"p"},"SyncInfo.CatchingUp")," field",(0,o.yg)("br",{parentName:"p"}),"\n","Syncing is complete when this field is ",(0,o.yg)("inlineCode",{parentName:"p"},"false")))}g.isMDXComponent=!0}}]);