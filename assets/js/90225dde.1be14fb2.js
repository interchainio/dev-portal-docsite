"use strict";(self.webpackChunkdev_portal_docsite=self.webpackChunkdev_portal_docsite||[]).push([[27346],{15680:(e,n,a)=>{a.d(n,{xA:()=>p,yg:()=>u});var i=a(96540);function o(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function t(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,i)}return a}function l(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?t(Object(a),!0).forEach((function(n){o(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function r(e,n){if(null==e)return{};var a,i,o=function(e,n){if(null==e)return{};var a,i,o={},t=Object.keys(e);for(i=0;i<t.length;i++)a=t[i],n.indexOf(a)>=0||(o[a]=e[a]);return o}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(i=0;i<t.length;i++)a=t[i],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=i.createContext({}),d=function(e){var n=i.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):l(l({},n),e)),a},p=function(e){var n=d(e.components);return i.createElement(s.Provider,{value:n},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},g=i.forwardRef((function(e,n){var a=e.components,o=e.mdxType,t=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),m=d(a),g=o,u=m["".concat(s,".").concat(g)]||m[g]||c[g]||t;return a?i.createElement(u,l(l({ref:n},p),{},{components:a})):i.createElement(u,l({ref:n},p))}));function u(e,n){var a=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var t=a.length,l=new Array(t);l[0]=g;var r={};for(var s in n)hasOwnProperty.call(n,s)&&(r[s]=n[s]);r.originalType=e,r[m]="string"==typeof e?e:o,l[1]=r;for(var d=2;d<t;d++)l[d]=a[d];return i.createElement.apply(null,l)}return i.createElement.apply(null,a)}g.displayName="MDXCreateElement"},26533:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>t,metadata:()=>r,toc:()=>d});var i=a(58168),o=(a(96540),a(15680));const t={sidebar_position:1},l="Module Manager",r={unversionedId:"build/building-modules/module-manager",id:"version-0.52/build/building-modules/module-manager",title:"Module Manager",description:"Cosmos SDK modules need to implement the AppModule interfaces, in order to be managed by the application's module manager. The module manager plays an important role in message and query routing, and allows application developers to set the order of execution of a variety of functions like PreBlocker, BeginBlocker and EndBlocker.",source:"@site/cosmos-sdk_versioned_docs/version-0.52/build/building-modules/01-module-manager.md",sourceDirName:"build/building-modules",slug:"/build/building-modules/module-manager",permalink:"/dev-portal-docsite/cosmos-sdk/build/building-modules/module-manager",draft:!1,tags:[],version:"0.52",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"buildSidebar",previous:{title:"Introduction to Cosmos SDK Modules",permalink:"/dev-portal-docsite/cosmos-sdk/build/building-modules/intro"},next:{title:"Messages and Queries",permalink:"/dev-portal-docsite/cosmos-sdk/build/building-modules/messages-and-queries"}},s={},d=[{value:"Application Module Interfaces",id:"application-module-interfaces",level:2},{value:"<code>AppModule</code>",id:"appmodule",level:3},{value:"<code>HasPreBlocker</code>",id:"haspreblocker",level:3},{value:"<code>HasBeginBlocker</code>",id:"hasbeginblocker",level:3},{value:"<code>HasEndBlocker</code>",id:"hasendblocker",level:3},{value:"<code>HasRegisterInterfaces</code>",id:"hasregisterinterfaces",level:3},{value:"<code>HasServices</code>",id:"hasservices",level:3},{value:"<code>HasAminoCodec</code>",id:"hasaminocodec",level:3},{value:"<code>module.HasGRPCGateway</code>",id:"modulehasgrpcgateway",level:3},{value:"<code>HasMigrations</code>",id:"hasmigrations",level:3},{value:"<code>HasConsensusVersion</code>",id:"hasconsensusversion",level:3},{value:"Genesis",id:"genesis",level:3},{value:"<code>HasGenesis</code>",id:"hasgenesis",level:4},{value:"<code>HasABCIGenesis</code>",id:"hasabcigenesis",level:4},{value:"Implementing the Application Module Interfaces",id:"implementing-the-application-module-interfaces",level:3},{value:"Module Manager",id:"module-manager-1",level:2},{value:"<code>Manager</code>",id:"manager",level:3}],p={toc:d},m="wrapper";function c(e){let{components:n,...a}=e;return(0,o.yg)(m,(0,i.A)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"module-manager"},"Module Manager"),(0,o.yg)("admonition",{title:"Synopsis",type:"note"},(0,o.yg)("p",{parentName:"admonition"},"Cosmos SDK modules need to implement the ",(0,o.yg)("a",{parentName:"p",href:"#application-module-interfaces"},(0,o.yg)("inlineCode",{parentName:"a"},"AppModule")," interfaces"),", in order to be managed by the application's ",(0,o.yg)("a",{parentName:"p",href:"#module-manager"},"module manager"),". The module manager plays an important role in ",(0,o.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/learn/advanced/baseapp#service-routers"},(0,o.yg)("inlineCode",{parentName:"a"},"message")," and ",(0,o.yg)("inlineCode",{parentName:"a"},"query")," routing"),", and allows application developers to set the order of execution of a variety of functions like ",(0,o.yg)("a",{parentName:"p",href:"https://docs.cosmos.network/main/learn/beginner/app-anatomy"},(0,o.yg)("inlineCode",{parentName:"a"},"PreBlocker"),", ",(0,o.yg)("inlineCode",{parentName:"a"},"BeginBlocker")," and ",(0,o.yg)("inlineCode",{parentName:"a"},"EndBlocker")),".")),(0,o.yg)("admonition",{title:"Pre-requisite Readings",type:"note"},(0,o.yg)("ul",{parentName:"admonition"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/intro"},"Introduction to Cosmos SDK Modules")))),(0,o.yg)("h2",{id:"application-module-interfaces"},"Application Module Interfaces"),(0,o.yg)("p",null,"Application module interfaces exist to facilitate the composition of modules together to form a functional Cosmos SDK application."),(0,o.yg)("p",null,"Those interface are defined in the ",(0,o.yg)("inlineCode",{parentName:"p"},"cosmossdk.io/core/appmodule")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"cosmossdk.io/core/appmodule/v2")," packages."),(0,o.yg)("admonition",{type:"note"},(0,o.yg)("p",{parentName:"admonition"},"The difference between appmodule and appmodule v2 is mainly the introduction of handlers from Cosmos SDK (server) v2. The rest of the API remains the same, and are simply aliases between the two packages.")),(0,o.yg)("p",null,"Following a list of all interfaces a module can implement:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#appmodule"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.AppModule"))," is the main interface that defines a module. By default, a module does nothing. To add functionalities, a module can implement extension interfaces."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#haspreblocker"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.HasPreBlocker")),": The extension interface that contains information about the ",(0,o.yg)("inlineCode",{parentName:"li"},"AppModule")," and ",(0,o.yg)("inlineCode",{parentName:"li"},"PreBlock"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#hasbeginblocker"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.HasBeginBlocker")),": The extension interface that contains information about the ",(0,o.yg)("inlineCode",{parentName:"li"},"AppModule")," and ",(0,o.yg)("inlineCode",{parentName:"li"},"BeginBlock"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#hasendblocker"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.HasEndBlocker")),": The extension interface that contains information about the ",(0,o.yg)("inlineCode",{parentName:"li"},"AppModule")," and ",(0,o.yg)("inlineCode",{parentName:"li"},"EndBlock"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#hasendblocker"},(0,o.yg)("inlineCode",{parentName:"a"},"module.HasABCIEndBlock")),": The extension interface that contains information about the ",(0,o.yg)("inlineCode",{parentName:"li"},"AppModule"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"EndBlock")," and returns an updated validator set (Usually only needed by staking)."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#hasregisterinterfaces"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.HasRegisterInterfaces")),": The extension interface for modules to register their message types."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#hasservices"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.HasService")),": The extension interface for modules to register services. Note, this interface is not exposed in core to avoid a gRPC dependency. However it is usable in an application."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#hasaminocodec"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.HasAminoCodec")),": The extension interface for modules to support JSON encoding and decoding via ",(0,o.yg)("inlineCode",{parentName:"li"},"amino"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#hasmigrations"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.HasMigrations")),": The extension interface for registering module migrations.",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#hasconsensusversion"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.HasConsensusVersion")),": The extension interface for declaring a module consensus version. It is usually not used alone, but in conjunction with ",(0,o.yg)("inlineCode",{parentName:"li"},"HasMigrations"),"."))),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#hasgenesis"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.HasGenesis"))," for inter-dependent genesis-related module functionalities."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#hasabcigenesis"},(0,o.yg)("inlineCode",{parentName:"a"},"appmodule.HasABCIGenesis"))," for inter-dependent genesis-related module functionalities, with validator set updates (Usually only needed by staking).")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"AppModule")," interface exists to define inter-dependent module methods. Many modules need to interact with other modules, typically through ",(0,o.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/keeper"},(0,o.yg)("inlineCode",{parentName:"a"},"keeper"),"s"),", which means there is a need for an interface where modules list their ",(0,o.yg)("inlineCode",{parentName:"p"},"keeper"),"s and other methods that require a reference to another module's object. ",(0,o.yg)("inlineCode",{parentName:"p"},"AppModule")," interface extension, such as ",(0,o.yg)("inlineCode",{parentName:"p"},"HasBeginBlocker")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"HasEndBlocker"),", also enables the module manager to set the order of execution between module's methods like ",(0,o.yg)("inlineCode",{parentName:"p"},"BeginBlock")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"EndBlock"),", which is important in cases where the order of execution between modules matters in the context of the application."),(0,o.yg)("p",null,"The usage of extension interfaces allows modules to define only the functionalities they need. For example, a module that does not need an ",(0,o.yg)("inlineCode",{parentName:"p"},"EndBlock")," does not need to define the ",(0,o.yg)("inlineCode",{parentName:"p"},"HasEndBlocker")," interface and thus the ",(0,o.yg)("inlineCode",{parentName:"p"},"EndBlock")," method. ",(0,o.yg)("inlineCode",{parentName:"p"},"AppModule")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"AppModuleGenesis")," are voluntarily small interfaces, that can take advantage of the ",(0,o.yg)("inlineCode",{parentName:"p"},"Module")," patterns without having to define many placeholder functions."),(0,o.yg)("admonition",{title:"legacy",type:"note"},(0,o.yg)("p",{parentName:"admonition"},"Prior to the introduction of the ",(0,o.yg)("inlineCode",{parentName:"p"},"cosmossdk.io/core")," package the interfaces were defined in the ",(0,o.yg)("inlineCode",{parentName:"p"},"types/module")," package of the Cosmos SDK. Not all interfaces have been migrated to core. Those legacy interfaces are still supported for backward compatibility, but aren't described in this document and should not be used in new modules.")),(0,o.yg)("h3",{id:"appmodule"},(0,o.yg)("inlineCode",{parentName:"h3"},"AppModule")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"AppModule")," interface defines a module. Modules can declare their functionalities by implementing extensions interfaces.\n",(0,o.yg)("inlineCode",{parentName:"p"},"AppModule"),"s are managed by the ",(0,o.yg)("a",{parentName:"p",href:"#manager"},"module manager"),", which checks which extension interfaces are implemented by the module."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/v2/module.go#L10-L20\n")),(0,o.yg)("h3",{id:"haspreblocker"},(0,o.yg)("inlineCode",{parentName:"h3"},"HasPreBlocker")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"HasPreBlocker")," is an extension interface from ",(0,o.yg)("inlineCode",{parentName:"p"},"appmodule.AppModule"),". All modules that have an ",(0,o.yg)("inlineCode",{parentName:"p"},"PreBlock")," method implement this interface."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/v2/module.go#L22-L28\n")),(0,o.yg)("h3",{id:"hasbeginblocker"},(0,o.yg)("inlineCode",{parentName:"h3"},"HasBeginBlocker")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"HasBeginBlocker")," is an extension interface from ",(0,o.yg)("inlineCode",{parentName:"p"},"appmodule.AppModule"),". All modules that have an ",(0,o.yg)("inlineCode",{parentName:"p"},"BeginBlock")," method implement this interface.\nIt gives module developers the option to implement logic that is automatically triggered at the beginning of each block."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/v2/module.go#L30-L38\n")),(0,o.yg)("h3",{id:"hasendblocker"},(0,o.yg)("inlineCode",{parentName:"h3"},"HasEndBlocker")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"HasEndBlocker")," is an extension interface from ",(0,o.yg)("inlineCode",{parentName:"p"},"appmodule.AppModule"),". All modules that have an ",(0,o.yg)("inlineCode",{parentName:"p"},"EndBlock")," method implement this interface. It gives module developers the option to implement logic that is automatically triggered at the end of each block."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/v2/module.go#L40-L48\n")),(0,o.yg)("p",null,"If a module needs to return validator set updates (staking), they can use ",(0,o.yg)("inlineCode",{parentName:"p"},"HasABCIEndBlock")," (in v1)."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.2/types/module/module.go#L115-L119\n")),(0,o.yg)("p",null,"Or, alternatively, ",(0,o.yg)("inlineCode",{parentName:"p"},"HasUpdateValidators")," in v2:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/v2/module.go#L87-L94\n")),(0,o.yg)("h3",{id:"hasregisterinterfaces"},(0,o.yg)("inlineCode",{parentName:"h3"},"HasRegisterInterfaces")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"HasRegisterInterfaces")," is an extension interface from ",(0,o.yg)("inlineCode",{parentName:"p"},"appmodule.AppModule"),". All modules that have a ",(0,o.yg)("inlineCode",{parentName:"p"},"RegisterInterfaces")," method implement this interface. It allows modules to register their message types with their concrete implementations as ",(0,o.yg)("inlineCode",{parentName:"p"},"proto.Message"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/v2/module.go#L103-L106\n")),(0,o.yg)("h3",{id:"hasservices"},(0,o.yg)("inlineCode",{parentName:"h3"},"HasServices")),(0,o.yg)("p",null,"This interface defines one method. It allows to register and let module expose gRPC services.\nThis interface is not part of the ",(0,o.yg)("inlineCode",{parentName:"p"},"core")," package to avoid a gRPC dependency, but is recognized by the module manager and ",(0,o.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/build/building-apps/runtime"},"runtime"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/module.go#L34-L53\n")),(0,o.yg)("h3",{id:"hasaminocodec"},(0,o.yg)("inlineCode",{parentName:"h3"},"HasAminoCodec")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"HasAminoCodec")," allows to register the ",(0,o.yg)("inlineCode",{parentName:"p"},"amino")," codec for the module, which is used to marshal and unmarshal structs to/from ",(0,o.yg)("inlineCode",{parentName:"p"},"[]byte")," in order to persist them in the module's ",(0,o.yg)("inlineCode",{parentName:"p"},"KVStore"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/module.go#L68-L72\n")),(0,o.yg)("h3",{id:"modulehasgrpcgateway"},(0,o.yg)("inlineCode",{parentName:"h3"},"module.HasGRPCGateway")),(0,o.yg)("p",null,"This interface is not part of the ",(0,o.yg)("inlineCode",{parentName:"p"},"core")," package to avoid a gRPC dependency. It is used to register gRPC routes gateway routes for the module. ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/issues/22715"},"In v2, this will be done differently, and totally abstracted from modules and module manager")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.2/types/module/module.go#L74-L77\n")),(0,o.yg)("h3",{id:"hasmigrations"},(0,o.yg)("inlineCode",{parentName:"h3"},"HasMigrations")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"HasMigrations")," interface is used to register module migrations. Learn more about ",(0,o.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/upgrade"},"module migrations"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/v2/migrations.go#L14-L21\n")),(0,o.yg)("h3",{id:"hasconsensusversion"},(0,o.yg)("inlineCode",{parentName:"h3"},"HasConsensusVersion")),(0,o.yg)("p",null,"This interface defines one method for checking a module consensus version. It is mainly used in conjunction with ",(0,o.yg)("inlineCode",{parentName:"p"},"HasMigrations"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/v2/migrations.go#L5-L12\n")),(0,o.yg)("h3",{id:"genesis"},"Genesis"),(0,o.yg)("h4",{id:"hasgenesis"},(0,o.yg)("inlineCode",{parentName:"h4"},"HasGenesis")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"HasGenesis")," is an extension interface for allowing modules to implement genesis functionalities."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/v2/genesis.go#L8-L19\n")),(0,o.yg)("p",null,"Let us go through some of the methods:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"DefaultGenesis()"),": Returns a default ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/genesis#genesisstate"},(0,o.yg)("inlineCode",{parentName:"a"},"GenesisState"))," for the module, marshalled to ",(0,o.yg)("inlineCode",{parentName:"li"},"json.RawMessage"),". The default ",(0,o.yg)("inlineCode",{parentName:"li"},"GenesisState")," need to be defined by the module developer and is primarily used for testing."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"ValidateGenesis(data json.RawMessage) error"),": Used to validate the ",(0,o.yg)("inlineCode",{parentName:"li"},"GenesisState")," defined by a module, given in its ",(0,o.yg)("inlineCode",{parentName:"li"},"json.RawMessage")," form. It will usually unmarshall the ",(0,o.yg)("inlineCode",{parentName:"li"},"json")," before running a custom ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/genesis#validategenesis"},(0,o.yg)("inlineCode",{parentName:"a"},"ValidateGenesis"))," function defined by the module developer.")),(0,o.yg)("p",null,"In the same vein than ",(0,o.yg)("inlineCode",{parentName:"p"},"HasABCIEndBlock"),", ",(0,o.yg)("inlineCode",{parentName:"p"},"HasABCIGenesis")," is used to return validator set updates."),(0,o.yg)("h4",{id:"hasabcigenesis"},(0,o.yg)("inlineCode",{parentName:"h4"},"HasABCIGenesis")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"HasABCIGenesis")," is an extension interface for allowing modules to implement genesis functionalities and returns validator set updates."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/core/v1.0.0-alpha.6/core/appmodule/v2/genesis.go#L21-L31\n")),(0,o.yg)("h3",{id:"implementing-the-application-module-interfaces"},"Implementing the Application Module Interfaces"),(0,o.yg)("p",null,"Typically, the various application module interfaces are implemented in a file called ",(0,o.yg)("inlineCode",{parentName:"p"},"module.go"),", located in the module's folder (e.g. ",(0,o.yg)("inlineCode",{parentName:"p"},"./x/module/module.go"),")."),(0,o.yg)("p",null,"Every module must implement the ",(0,o.yg)("inlineCode",{parentName:"p"},"AppModule")," interface. If the module is only used for genesis, it will implement ",(0,o.yg)("inlineCode",{parentName:"p"},"HasGenesis")," in addition of ",(0,o.yg)("inlineCode",{parentName:"p"},"AppModule"),". The concrete type that implements the interface can add parameters that are required for the implementation of the various methods of the interface. "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"// example\ntype AppModule struct {\n    keeper       Keeper\n}\n\nfunc (AppModule) IsAppModule() {}\nfunc (AppModule) IsOnePerModuleType() {}\n")),(0,o.yg)("h2",{id:"module-manager-1"},"Module Manager"),(0,o.yg)("p",null,"The module manager is used to manage collections of ",(0,o.yg)("inlineCode",{parentName:"p"},"AppModule")," and all the extensions interfaces."),(0,o.yg)("h3",{id:"manager"},(0,o.yg)("inlineCode",{parentName:"h3"},"Manager")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"Manager")," is a structure that holds all the ",(0,o.yg)("inlineCode",{parentName:"p"},"AppModule")," of an application, and defines the order of execution between several key components of these modules:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.2/types/module/module.go#L121-L133\n")),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"Thanks to ",(0,o.yg)("inlineCode",{parentName:"p"},"runtime"),", a user does not need to interact directly with the ",(0,o.yg)("inlineCode",{parentName:"p"},"Manager"),". The ",(0,o.yg)("inlineCode",{parentName:"p"},"Manager")," is used internally by the ",(0,o.yg)("inlineCode",{parentName:"p"},"runtime")," to manage the modules of the application.")),(0,o.yg)("p",null,"The module manager is used throughout the application whenever an action on a collection of modules is required. It implements the following methods:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"NewManager(modules ...AppModule)"),": Constructor function. It takes a list of the application's ",(0,o.yg)("inlineCode",{parentName:"li"},"AppModule"),"s and builds a new ",(0,o.yg)("inlineCode",{parentName:"li"},"Manager"),". It is generally called from the application's main ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/beginner/app-anatomy#constructor-function"},"constructor function"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"SetOrderInitGenesis(moduleNames ...string)"),": Sets the order in which the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/genesis#initgenesis"},(0,o.yg)("inlineCode",{parentName:"a"},"InitGenesis"))," function of each module will be called when the application is first started. This function is generally called from the application's main ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/beginner/app-anatomy#constructor-function"},"constructor function"),".\nTo initialize modules successfully, module dependencies should be considered. For example, the ",(0,o.yg)("inlineCode",{parentName:"li"},"genutil")," module must occur after ",(0,o.yg)("inlineCode",{parentName:"li"},"staking")," module so that the pools are properly initialized with tokens from genesis accounts, the ",(0,o.yg)("inlineCode",{parentName:"li"},"genutils")," module must also occur after ",(0,o.yg)("inlineCode",{parentName:"li"},"auth")," so that it can access the params from auth, IBC's ",(0,o.yg)("inlineCode",{parentName:"li"},"capability")," module should be initialized before all other modules so that it can initialize any capabilities."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"SetOrderExportGenesis(moduleNames ...string)"),": Sets the order in which the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/genesis#exportgenesis"},(0,o.yg)("inlineCode",{parentName:"a"},"ExportGenesis"))," function of each module will be called in case of an export. This function is generally called from the application's main ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/beginner/app-anatomy#constructor-function"},"constructor function"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"SetOrderPreBlockers(moduleNames ...string)"),": Sets the order in which the ",(0,o.yg)("inlineCode",{parentName:"li"},"PreBlock()")," function of each module will be called before ",(0,o.yg)("inlineCode",{parentName:"li"},"BeginBlock()")," of all modules. This function is generally called from the application's main ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/beginner/app-anatomy#constructor-function"},"constructor function"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"SetOrderBeginBlockers(moduleNames ...string)"),": Sets the order in which the ",(0,o.yg)("inlineCode",{parentName:"li"},"BeginBlock()")," function of each module will be called at the beginning of each block. This function is generally called from the application's main ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/beginner/app-anatomy#constructor-function"},"constructor function"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"SetOrderEndBlockers(moduleNames ...string)"),": Sets the order in which the ",(0,o.yg)("inlineCode",{parentName:"li"},"EndBlock()")," function of each module will be called at the end of each block. This function is generally called from the application's main ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/beginner/app-anatomy#constructor-function"},"constructor function"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"SetOrderPrecommiters(moduleNames ...string)"),": Sets the order in which the ",(0,o.yg)("inlineCode",{parentName:"li"},"Precommit()")," function of each module will be called during commit of each block. This function is generally called from the application's main ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/beginner/app-anatomy#constructor-function"},"constructor function"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"SetOrderPrepareCheckStaters(moduleNames ...string)"),": Sets the order in which the ",(0,o.yg)("inlineCode",{parentName:"li"},"PrepareCheckState()")," function of each module will be called during commit of each block. This function is generally called from the application's main ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/beginner/app-anatomy#constructor-function"},"constructor function"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"SetOrderMigrations(moduleNames ...string)"),": Sets the order of migrations to be run. If not set then migrations will be run with an order defined in ",(0,o.yg)("inlineCode",{parentName:"li"},"DefaultMigrationsOrder"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"RegisterServices(cfg Configurator)"),": Registers the services of modules implementing the ",(0,o.yg)("inlineCode",{parentName:"li"},"HasServices")," interface."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"InitGenesis(ctx context.Context, genesisData map[string]json.RawMessage)"),": Calls the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/genesis#initgenesis"},(0,o.yg)("inlineCode",{parentName:"a"},"InitGenesis"))," function of each module when the application is first started, in the order defined in ",(0,o.yg)("inlineCode",{parentName:"li"},"OrderInitGenesis"),". Returns an ",(0,o.yg)("inlineCode",{parentName:"li"},"abci.InitChainResponse")," to the underlying consensus engine, which can contain validator updates."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"ExportGenesis(ctx context.Context)"),": Calls the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/genesis#exportgenesis"},(0,o.yg)("inlineCode",{parentName:"a"},"ExportGenesis"))," function of each module, in the order defined in ",(0,o.yg)("inlineCode",{parentName:"li"},"OrderExportGenesis"),". The export constructs a genesis file from a previously existing state, and is mainly used when a hard-fork upgrade of the chain is required."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"ExportGenesisForModules(ctx context.Context, modulesToExport []string)"),": Behaves the same as ",(0,o.yg)("inlineCode",{parentName:"li"},"ExportGenesis"),", except takes a list of modules to export."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"BeginBlock(ctx context.Context) error"),": At the beginning of each block, this function is called from ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/advanced/baseapp#beginblock"},(0,o.yg)("inlineCode",{parentName:"a"},"BaseApp"))," and, in turn, calls the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/preblock-beginblock-endblock"},(0,o.yg)("inlineCode",{parentName:"a"},"BeginBlock"))," function of each modules implementing the ",(0,o.yg)("inlineCode",{parentName:"li"},"appmodule.HasBeginBlocker")," interface, in the order defined in ",(0,o.yg)("inlineCode",{parentName:"li"},"OrderBeginBlockers"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"EndBlock(ctx context.Context) error"),": At the end of each block, this function is called from ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/advanced/baseapp#endblock"},(0,o.yg)("inlineCode",{parentName:"a"},"BaseApp"))," and, in turn, calls the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/preblock-beginblock-endblock"},(0,o.yg)("inlineCode",{parentName:"a"},"EndBlock"))," function of each modules implementing the ",(0,o.yg)("inlineCode",{parentName:"li"},"appmodule.HasEndBlocker")," interface, in the order defined in ",(0,o.yg)("inlineCode",{parentName:"li"},"OrderEndBlockers"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"EndBlock(context.Context) ([]abci.ValidatorUpdate, error)"),": At the end of each block, this function is called from ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/advanced/baseapp#endblock"},(0,o.yg)("inlineCode",{parentName:"a"},"BaseApp"))," and, in turn, calls the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/preblock-beginblock-endblock"},(0,o.yg)("inlineCode",{parentName:"a"},"EndBlock"))," function of each modules implementing the ",(0,o.yg)("inlineCode",{parentName:"li"},"appmodule.HasABCIEndBlock")," interface, in the order defined in ",(0,o.yg)("inlineCode",{parentName:"li"},"OrderEndBlockers"),". Extended implementation for modules that need to update the validator set (typically used by the staking module)."),(0,o.yg)("li",{parentName:"ul"},"(Optional) ",(0,o.yg)("inlineCode",{parentName:"li"},"RegisterLegacyAminoCodec(cdc *codec.LegacyAmino)"),": Registers the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/advanced/encoding#amino"},(0,o.yg)("inlineCode",{parentName:"a"},"codec.LegacyAmino"),"s")," of each of the application module. This function is usually called early on in the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/learn/beginner/app-anatomy#constructor"},"application's construction"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"RegisterInterfaces(registry codectypes.InterfaceRegistry)"),": Registers interface types and implementations of each of the application's ",(0,o.yg)("inlineCode",{parentName:"li"},"AppModule"),"."),(0,o.yg)("li",{parentName:"ul"},"(Optional) ",(0,o.yg)("inlineCode",{parentName:"li"},"RegisterGRPCGatewayRoutes(clientCtx client.Context, rtr *runtime.ServeMux)"),": Registers gRPC routes for modules."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"DefaultGenesis(cdc codec.JSONCodec)"),": Provides default genesis information for modules in the application by calling the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/genesis#defaultgenesis"},(0,o.yg)("inlineCode",{parentName:"a"},"DefaultGenesis(cdc codec.JSONCodec)"))," function of each module. It only calls the modules that implements the ",(0,o.yg)("inlineCode",{parentName:"li"},"HasGenesisBasics")," interfaces."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"ValidateGenesis(cdc codec.JSONCodec, txEncCfg client.TxEncodingConfig, genesis map[string]json.RawMessage)"),": Validates the genesis information modules by calling the ",(0,o.yg)("a",{parentName:"li",href:"/dev-portal-docsite/cosmos-sdk/build/building-modules/genesis#validategenesis"},(0,o.yg)("inlineCode",{parentName:"a"},"ValidateGenesis(codec.JSONCodec, client.TxEncodingConfig, json.RawMessage)"))," function of modules implementing the ",(0,o.yg)("inlineCode",{parentName:"li"},"HasGenesisBasics")," interface.")),(0,o.yg)("p",null,"Here's an example of a concrete integration within ",(0,o.yg)("a",{parentName:"p",href:"/dev-portal-docsite/cosmos-sdk/build/building-apps/runtime"},(0,o.yg)("inlineCode",{parentName:"a"},"runtime"))),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.52.0-beta.2/runtime/module.go#L242-L244\n")))}c.isMDXComponent=!0}}]);